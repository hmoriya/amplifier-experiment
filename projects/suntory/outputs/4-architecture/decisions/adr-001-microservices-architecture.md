# ADR-001: マイクロサービスアーキテクチャの採用

## ステータス
**承認済み** (2025-12-05)

## コンテキスト

サントリーグループは、5つの事業（飲料、スピリッツ、ビール、ワイン、健康食品）を持つ多角的企業である。現在、各事業が独立したシステムを持ち、以下の課題がある：

1. **システム間連携の複雑性**: 各事業システム間のデータ連携が場当たり的
2. **重複投資**: 類似機能を各事業で個別開発
3. **変更の困難さ**: モノリシックなレガシーシステムの変更が困難
4. **スケーラビリティ**: 繁忙期（夏季：飲料、年末：酒類）の負荷対応が困難
5. **技術的負債**: 異なる時代に構築されたシステムの統合が困難

## 決定

**マイクロサービスアーキテクチャを採用する**

15のサービスに分割し、各サービスは：
- 単一の責務を持つ
- 独立してデプロイ可能
- 専用のデータストアを持つ
- APIまたはイベントで連携する

### サービス分類

| 分類 | サービス数 | 例 |
|------|------------|-----|
| Core | 13 | R&D Platform, Manufacturing (×5) |
| Supporting | 4 | Supply Chain, Customer Platform |
| Platform | 3 | IT Platform, Finance, HR |

## 結果

### 良い影響

1. **独立したデプロイ**: 各事業のペースで開発・リリース可能
2. **技術的多様性**: サービスごとに最適な技術スタックを選択可能
3. **スケーラビリティ**: サービス単位でスケールアウト可能
4. **障害分離**: 1サービスの障害が全体に波及しにくい
5. **チーム自律性**: サービスごとにチームが責任を持つ

### 悪い影響/トレードオフ

1. **分散システムの複雑性**: ネットワーク遅延、部分障害への対応が必要
2. **運用オーバーヘッド**: 監視、デプロイ、トラブルシュートが複雑化
3. **データ整合性**: 結果整合性モデルの採用が必要
4. **テストの複雑化**: エンドツーエンドテストが困難
5. **初期コスト**: インフラ構築、チーム組成の初期投資が必要

### リスク

1. **サービス境界の誤り**: 再設計が必要になる可能性
   - 軽減策: DDD手法での慎重な境界設計、段階的移行
2. **分散トランザクション**: Sagaパターンの実装複雑性
   - 軽減策: イベント駆動、結果整合性の受け入れ
3. **組織の準備不足**: DevOps文化の不足
   - 軽減策: 段階的移行、トレーニング投資

## 代替案

### 代替案1: モジュラーモノリス

モノリシックアプリケーション内でモジュール分割を行う。

**評価**:
- 利点: 運用シンプル、分散システムの複雑性なし
- 欠点: 独立デプロイ不可、スケールが困難
- 却下理由: 5事業の独立性と異なるスケール要件に対応できない

### 代替案2: SOA（サービス指向アーキテクチャ）

ESBを中心とした従来型SOA。

**評価**:
- 利点: 成熟した技術、既存ノウハウ活用
- 欠点: ESBがボトルネック、柔軟性に欠ける
- 却下理由: 現代的なクラウドネイティブ要件に合わない

### 代替案3: サーバーレスファースト

AWS Lambda等のサーバーレス基盤を主軸にする。

**評価**:
- 利点: 運用オーバーヘッド削減、自動スケーリング
- 欠点: ベンダーロックイン、コールドスタート問題
- 却下理由: 製造系の長時間処理に不向き、コスト予測困難

## 関連

- ADR-002: イベントバスとしてKafkaを選択
- ADR-003: API Gatewayパターンの採用
- ADR-004: Database per Serviceパターン
- service-boundaries.md: サービス境界定義
- context-map.md: サービス間関係
