# Operation: op-002 水質基準設定 [SetQualityStandard]

## 概要

| 項目 | 値 |
|------|-----|
| ID | op-002 |
| 日本語名 | 水質基準設定 |
| 英語名 | SetQualityStandard |
| 定数名 | SET_QUALITY_STANDARD |
| 所属Capability | cap-001 水質分析 |
| ステータス | Draft |

## 説明

製品カテゴリごとの水質基準を設定・更新する。
基準値は承認フローを経て確定し、有効開始日から適用される。

## 事前条件

- 設定者が品質管理責任者であること
- 製品カテゴリが定義済みであること

## 事後条件

- 品質基準が登録されていること
- 承認待ちまたは承認済みステータスであること
- 基準履歴が更新されていること

## 入力

| パラメータ | 型 | 必須 | 説明 |
|------------|-----|------|------|
| productCategory | String | Yes | 製品カテゴリ |
| parameters | QualityParameter[] | Yes | 基準パラメータリスト |
| effectiveFrom | Date | Yes | 有効開始日 |
| reason | String | Yes | 設定・変更理由 |
| requestedBy | UUID | Yes | 申請者ID |

## 出力

| フィールド | 型 | 説明 |
|------------|-----|------|
| standardId | UUID | 品質基準ID |
| version | Integer | バージョン番号 |
| status | Enum | ステータス（PENDING/APPROVED/REJECTED） |
| createdAt | DateTime | 作成日時 |

## ビジネスルール

1. **BR-001**: 品質基準の変更は品質管理責任者の承認が必要
2. **BR-002**: 有効開始日は申請日から7営業日以降
3. **BR-003**: 既存基準より緩い変更は追加承認が必要
4. **BR-004**: 基準履歴は無期限保持

## 例外・エラー

| エラーコード | 条件 | メッセージ |
|--------------|------|------------|
| E001 | 権限不足 | 品質基準の設定権限がありません |
| E002 | 無効な有効日 | 有効開始日は7営業日以降を指定してください |
| E003 | パラメータ不正 | 基準パラメータの値が不正です |

## 関連UseCase

| ID | 名称 |
|----|------|
| uc-002 | 基準設定 [StandardSetting] |

## シーケンス

```
1. 基準設定リクエストを受け付ける
2. 申請者の権限を検証する
3. パラメータの妥当性を検証する
4. 有効開始日を検証する
5. 品質基準を仮登録する
6. 承認者に通知を送信する
7. 承認後、基準を確定する
8. 基準更新イベントを発行する
```

## ドメインイベント

| イベント | 発行条件 |
|----------|----------|
| QualityStandardRequested | 基準申請時 |
| QualityStandardApproved | 基準承認時 |
| QualityStandardUpdated | 基準発効時 |

---

**作成日**: 2025-12-05
**更新日**: 2025-12-05
**作成者**: AI Assistant
