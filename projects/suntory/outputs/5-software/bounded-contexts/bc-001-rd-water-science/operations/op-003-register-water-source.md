# Operation: op-003 水源登録 [RegisterWaterSource]

## 概要

| 項目 | 値 |
|------|-----|
| ID | op-003 |
| 日本語名 | 水源登録 |
| 英語名 | RegisterWaterSource |
| 定数名 | REGISTER_WATER_SOURCE |
| 所属Capability | cap-002 水源管理 |
| ステータス | Draft |

## 説明

新規に発見または取得した水源を登録する。
位置情報、水源種別、基本特性を記録し、水源マップに反映する。

## 事前条件

- 登録者が水源管理担当者であること
- 水源の位置情報が取得済みであること
- 初回水質検査が実施済みであること

## 事後条件

- 水源が登録されていること
- 水源マップに反映されていること
- 初期水質データが関連付けられていること

## 入力

| パラメータ | 型 | 必須 | 説明 |
|------------|-----|------|------|
| name | String | Yes | 水源名 |
| location | GeoJSON | Yes | 位置情報 |
| address | String | Yes | 所在地住所 |
| sourceType | Enum | Yes | 種別（地下水/湧水/河川/その他） |
| discoveredAt | Date | Yes | 発見日 |
| initialTestId | UUID | Yes | 初回水質検査ID |
| owner | String | No | 所有者情報 |
| notes | String | No | 備考 |

## 出力

| フィールド | 型 | 説明 |
|------------|-----|------|
| sourceId | UUID | 水源ID |
| name | String | 水源名 |
| status | Enum | ステータス（ACTIVE/INACTIVE/UNDER_REVIEW） |
| createdAt | DateTime | 登録日時 |
| registeredBy | UUID | 登録者ID |

## ビジネスルール

1. **BR-001**: 同一位置（半径100m以内）に既存水源がないこと
2. **BR-002**: 初回水質検査で合格していること
3. **BR-003**: 位置情報は日本国内であること
4. **BR-004**: 水源名は一意であること

## 例外・エラー

| エラーコード | 条件 | メッセージ |
|--------------|------|------------|
| E001 | 重複水源 | 近傍に既存の水源が登録されています |
| E002 | 検査不合格 | 初回水質検査が不合格です |
| E003 | 位置情報不正 | 位置情報が日本国内ではありません |
| E004 | 名称重複 | 同名の水源が既に存在します |

## 関連UseCase

| ID | 名称 |
|----|------|
| uc-003 | 水源登録 [SourceRegistration] |

## シーケンス

```
1. 水源情報を受け付ける
2. 位置情報の妥当性を検証する
3. 重複水源をチェックする
4. 初回水質検査結果を検証する
5. 水源を登録する
6. 水源マップを更新する
7. 水源登録イベントを発行する
```

## ドメインイベント

| イベント | 発行条件 |
|----------|----------|
| WaterSourceRegistered | 水源登録完了時 |

---

**作成日**: 2025-12-05
**更新日**: 2025-12-05
**作成者**: AI Assistant
