# Operation: op-004 涵養活動記録 [RecordConservation]

## 概要

| 項目 | 値 |
|------|-----|
| ID | op-004 |
| 日本語名 | 涵養活動記録 |
| 英語名 | RecordConservation |
| 定数名 | RECORD_CONSERVATION |
| 所属Capability | cap-002 水源管理 |
| ステータス | Draft |

## 説明

水源涵養活動（森林保全、植樹、地下水涵養等）を記録する。
活動実績、参加者、成果を記録し、涵養面積の累計を更新する。

## 事前条件

- 対象水源が登録済みであること
- 記録者が水源管理担当者であること
- 活動が実施済みであること

## 事後条件

- 涵養活動が記録されていること
- 涵養面積累計が更新されていること
- 添付ファイル（写真等）が保存されていること

## 入力

| パラメータ | 型 | 必須 | 説明 |
|------------|-----|------|------|
| sourceId | UUID | Yes | 水源ID |
| activityType | Enum | Yes | 活動種別（植樹/間伐/清掃/調査/その他） |
| activityDate | Date | Yes | 活動日 |
| area | Decimal | No | 活動面積（ha） |
| participants | Integer | Yes | 参加人数 |
| description | String | Yes | 活動内容 |
| attachments | File[] | No | 添付ファイル（写真・動画） |
| recordedBy | UUID | Yes | 記録者ID |

## 出力

| フィールド | 型 | 説明 |
|------------|-----|------|
| activityId | UUID | 活動ID |
| sourceId | UUID | 水源ID |
| totalArea | Decimal | 累計涵養面積（ha） |
| createdAt | DateTime | 記録日時 |

## ビジネスルール

1. **BR-001**: 活動日は記録日以前であること
2. **BR-002**: 1回の活動で記録できる面積は最大100ha
3. **BR-003**: 写真は最大10枚まで添付可能
4. **BR-004**: 同一水源・同一日の重複記録は不可

## 例外・エラー

| エラーコード | 条件 | メッセージ |
|--------------|------|------------|
| E001 | 水源未登録 | 指定された水源が登録されていません |
| E002 | 未来日 | 活動日は本日以前を指定してください |
| E003 | 重複記録 | 同日の活動が既に記録されています |
| E004 | ファイル超過 | 添付ファイルは10件までです |

## 関連UseCase

| ID | 名称 |
|----|------|
| uc-004 | 涵養記録 [ConservationRecord] |

## シーケンス

```
1. 活動情報を受け付ける
2. 水源の存在を検証する
3. 入力データを検証する
4. 添付ファイルを保存する
5. 活動記録を登録する
6. 累計涵養面積を更新する
7. 活動記録イベントを発行する
```

## ドメインイベント

| イベント | 発行条件 |
|----------|----------|
| ConservationActivityRecorded | 活動記録完了時 |

---

**作成日**: 2025-12-05
**更新日**: 2025-12-05
**作成者**: AI Assistant
