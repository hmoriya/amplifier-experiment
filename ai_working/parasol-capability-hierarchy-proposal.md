# Parasol V5 ケイパビリティ階層設計提案

## ステータス: ドラフト - サブエージェント討議用

作成日: 2024-01-XX
作成者: Amplifier協調分析

---

## 1. 背景と課題

### 1.1 現状の問題

Parasol V5フレームワークにおいて、以下の概念が重複・混乱している：

| 問題 | 詳細 |
|------|------|
| **Subdomain vs CL2** | DDD用語とParasol用語の混在 |
| **CL3 vs Business Operation** | コンテナかインスタンスか不明確 |
| **CL3 vs BC** | ビジネス定義と技術設計の境界が曖昧 |
| **命名の一貫性** | DDD用語がビジネスユーザーに難解 |

### 1.2 設計意図

**ケイパビリティ階層は、ビジネスユーザーからの理解しやすさと進化を狙っている。**

つまり：
- DDD用語をそのまま使わない（技術者以外に難解）
- ビジネス文脈で理解可能な用語体系
- フレームワークの独自進化の余地を残す

---

## 2. 提案: ビジネスフレンドリーなケイパビリティ階層

### 2.1 階層構造

```
Value Stream (VS0-VS7)
        │
        ▼
┌─────────────────────────────────────────────────────────────────┐
│ CL1: 活動領域 (Activity Area)                                    │
├─────────────────────────────────────────────────────────────────┤
│ 質問: 【WHAT領域】何の活動領域か？                                │
│ 対象: 経営層・事業企画                                           │
│ 目的: 投資判断・リソース配分の単位                                │
│ 分類: Core（差別化）/ Supporting（重要）/ Generic（標準）         │
│ 例:   A1基盤技術研究, A2原料調達, A3酒類製品開発                  │
└─────────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────┐
│ CL2: ケイパビリティ (Capability) ★メイン概念                      │
├─────────────────────────────────────────────────────────────────┤
│ 質問: 【HOW構造】どう組織するか？                                 │
│ 対象: 事業部長・プロダクトオーナー                                │
│ 目的: チーム境界・システム境界・データ所有権の定義                 │
│ 粒度: ≈ マイクロサービス候補                                      │
│ 例:   fermentation-research, premium-beer-development            │
└─────────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────┐
│ CL3: 業務オペレーション (Business Operation)                      │
├─────────────────────────────────────────────────────────────────┤
│ 質問: 【WHAT詳細】具体的に何をするか？                            │
│ 対象: 業務担当者・ドメインエキスパート                            │
│ 目的: 日々の業務活動の定義                                        │
│ 構造: トリガー → 活動内容 → 成果物                                │
│ 例:   酵母株探索・収集, 酵母株育種・改良, 発酵条件最適化          │
└─────────────────────────────────────────────────────────────────┘
        │
        ▼ [技術者向け - 必要時のみ展開]
┌─────────────────────────────────────────────────────────────────┐
│ BC: 実装設計 (Bounded Context)                                    │
├─────────────────────────────────────────────────────────────────┤
│ 質問: 【HOW実装】どう実装するか？                                 │
│ 対象: 開発者・アーキテクト                                        │
│ 目的: 技術設計・実装仕様の定義                                    │
│ 内容: 集約 / ドメインイベント / API契約 / ユビキタス言語          │
│ 例:   fermentation-research-bc.md                                │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 ZIGZAGパターン

各レベルが「WHAT」と「HOW」を交互に問う：

```
WHAT       →      HOW        →      WHAT       →      HOW
何の領域?        どう組織?         何をする?         どう実装?
    │               │                │                │
   CL1            CL2              CL3              BC
 活動領域     ケイパビリティ     業務OP          実装設計
 ─────────   ────────────     ─────────       ─────────
  経営層        事業部長        業務担当         開発者
```

### 2.3 各レベルの詳細定義

#### CL1: 活動領域 (Activity Area)

| 属性 | 説明 |
|------|------|
| **日本語名** | 活動領域 |
| **英語名** | Activity Area |
| **質問** | 「この企業は何の活動領域を持つか？」 |
| **分類方法** | Core / Supporting / Generic |
| **投資配分目安** | Core 70% / Supporting 25% / Generic 5% |
| **成果物** | cl1-activity-areas.md |

**Core（コア）活動領域の判定基準:**
- 競争優位の源泉か？
- 独自ノウハウが必要か？
- 外部委託で差別化が失われるか？

#### CL2: ケイパビリティ (Capability)

| 属性 | 説明 |
|------|------|
| **日本語名** | ケイパビリティ |
| **英語名** | Capability |
| **質問** | 「この活動領域をどう組織単位に分けるか？」 |
| **境界決定要因** | チーム独立性、データ所有権、デプロイ独立性 |
| **粒度目安** | 5-9名のチームで担当可能な範囲 |
| **成果物** | cl2-capabilities.md |

**ケイパビリティ分割の原則:**
1. **高凝集**: 関連する業務オペレーションをグループ化
2. **低結合**: 他ケイパビリティとの依存を最小化
3. **独立性**: 独立してデプロイ・進化可能

#### CL3: 業務オペレーション (Business Operation)

| 属性 | 説明 |
|------|------|
| **日本語名** | 業務オペレーション |
| **英語名** | Business Operation |
| **質問** | 「このケイパビリティで具体的に何をするか？」 |
| **定義要素** | トリガー、活動内容、成果物、業務ルール |
| **粒度目安** | 1日〜1週間で完結する業務単位 |
| **成果物** | cl3-operations/{capability}-operations.md |

**業務オペレーションの構造:**
```yaml
operation:
  id: OP-fermentation-001
  name: 酵母株探索・収集
  trigger: 新製品開発要件の確定
  activities:
    - 候補酵母株のスクリーニング
    - 特性評価（発酵力、香味成分）
    - 有望株の選定・保存
  output: 候補酵母株リスト
  rules:
    - 最低3株以上を候補として選定
    - 食品安全基準への適合確認必須
  managed_data:
    - 酵母株マスタ
    - 特性評価結果
```

#### BC: 実装設計 (Bounded Context)

| 属性 | 説明 |
|------|------|
| **日本語名** | 実装設計 |
| **英語名** | Bounded Context |
| **質問** | 「業務オペレーションをどう実装するか？」 |
| **定義要素** | 集約、エンティティ、値オブジェクト、ドメインイベント、API |
| **対象読者** | 開発者・アーキテクト |
| **成果物** | bounded-contexts/{capability}-bc.md |

**実装設計の構造:**
```yaml
bounded_context:
  name: fermentation-research
  aggregates:
    - name: YeastStrain
      root: YeastStrain
      entities: [StrainCharacteristic, FermentationResult]
      value_objects: [StrainId, GeneticProfile]
  domain_events:
    - YeastStrainRegistered
    - CharacteristicEvaluated
    - StrainApproved
  api_contracts:
    - POST /yeast-strains
    - GET /yeast-strains/{id}
    - POST /yeast-strains/{id}/evaluations
```

---

## 3. DDD対応表

技術者向けの参照マッピング（ビジネスユーザーには提示不要）：

| Parasol用語 | DDD用語 | 備考 |
|-------------|---------|------|
| 活動領域 (CL1) | Domain + Strategic Classification | 投資判断を含む拡張 |
| ケイパビリティ (CL2) | Subdomain | チーム境界の明示を追加 |
| 業務オペレーション (CL3) | Use Case / Business Process | トリガー/成果物を構造化 |
| 実装設計 (BC) | Bounded Context | 同一概念 |

**注意:** このマッピングは技術者の理解補助用。ビジネスユーザーにはParasol用語のみを使用する。

---

## 4. ファイル構造

```
outputs/3-capabilities/
├── {vs-slug}/
│   ├── cl1-activity-areas.md          # 活動領域分類
│   ├── cl2-capabilities.md            # ケイパビリティ設計
│   ├── cl3-operations/                # 業務オペレーション
│   │   ├── {capability-1}-operations.md
│   │   └── {capability-2}-operations.md
│   └── bounded-contexts/              # 実装設計（技術者向け）
│       ├── {capability-1}-bc.md
│       └── {capability-2}-bc.md
```

---

## 5. コマンド体系

```bash
# 活動領域の分類（CL1）
/parasol:3-capabilities cl1

# ケイパビリティ設計（CL2）- VS単位
/parasol:3-capabilities cl2 VS2

# 業務オペレーション定義（CL3）- ケイパビリティ単位
/parasol:3-capabilities cl3 fermentation-research

# 実装設計（BC）- ケイパビリティ単位、技術者向け
/parasol:3-capabilities bc fermentation-research
```

---

## 6. 討議ポイント

### 6.1 アーキテクチャ観点
- CL2とCL3の境界は適切か？
- ケイパビリティの粒度判定基準は十分か？

### 6.2 API/契約観点
- CL3の業務オペレーションからAPIへの導出は明確か？
- BC間の契約はどこで定義されるか？

### 6.3 曖昧性観点
- まだ残っている曖昧性はあるか？
- 意図的に残すべき曖昧性はあるか？

### 6.4 歴史的整合性
- DDDの本来の意図と矛盾していないか？
- 業界標準との乖離は許容範囲か？

---

## 7. 変更履歴

| 日付 | 変更内容 | 担当 |
|------|----------|------|
| 2024-XX-XX | 初版作成 | Amplifier協調分析 |
