# Parasol V5 全体構成図

**バージョン**: V5.8（CL2/BC/CL3の境界役割を明確化）

本ドキュメントは Parasol V5 フレームワークの全体像を視覚的に示します。

---

## 1. フレームワーク全体構成

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    Parasol V5 全体構成図                                    ┃
┃                                                                             ┃
┃  ビジネス領域                           ソフトウェア領域                    ┃
┃  (Business Space)                      (Software Space)                    ┃
┃                                                                             ┃
┃  ┌────────────────────────────┐        ┌────────────────────────────┐      ┃
┃  │ Phase 1: Context           │        │ Phase 7: Platform          │      ┃
┃  │ 組織・市場・制約の理解     │        │ インフラ・運用基盤         │      ┃
┃  └────────────────────────────┘        └────────────────────────────┘      ┃
┃              ↓                                      ↑                       ┃
┃  ╔══════════════════════════════════════════════════════════════════╗      ┃
┃  ║  Level 1: ビジネス層 (What-How)                                   ║      ┃
┃  ╠══════════════════════════════════════════════════════════════════╣      ┃
┃  ║  Phase 2: Value Definition                                        ║      ┃
┃  ║  ┌──────────────────┐     ┌──────────────────────┐               ║      ┃
┃  ║  │ WHAT: 価値       │ ─→  │ HOW: Value Stream    │               ║      ┃
┃  ║  │ 何を実現？       │     │ VS0→VS1→...→VS7     │               ║      ┃
┃  ║  └──────────────────┘     └──────────────────────┘               ║      ┃
┃  ╚══════════════════════════════════════════════════════════════════╝      ┃
┃              ↓                                                              ┃
┃  ╔══════════════════════════════════════════════════════════════════╗      ┃
┃  ║  Level 2: サービス層 (What-How)                                   ║      ┃
┃  ╠══════════════════════════════════════════════════════════════════╣      ┃
┃  ║  Phase 3: Capabilities              Phase 4: Application Design   ║      ┃
┃  ║  ┌──────────────────┐              ┌──────────────────────┐      ║      ┃
┃  ║  │ WHAT: Capability │      ─→      │ HOW: Service設計     │      ║      ┃
┃  ║  │                  │              │ - Bounded Context    │      ║      ┃
┃  ║  │ CL1: 活動領域    │              │ - Context Map        │      ║      ┃
┃  ║  │ CL2: ケイパビリティ│             │ - 【実装UC開始】     │      ║      ┃
┃  ║  │ CL3: 【ビジネスUC】│             └──────────────────────┘      ║      ┃
┃  ║  └──────────────────┘                                             ║      ┃
┃  ╚══════════════════════════════════════════════════════════════════╝      ┃
┃              ↓                              ↓                               ┃
┃  ╔══════════════════════════════════════════════════════════════════╗      ┃
┃  ║  Level 3: 実装層 (What-How)                                       ║      ┃
┃  ╠══════════════════════════════════════════════════════════════════╣      ┃
┃  ║  Phase 5: Software Design           Phase 6: Implementation       ║      ┃
┃  ║  ┌──────────────────┐              ┌──────────────────────┐      ║      ┃
┃  ║  │ WHAT: 設計       │      ─→      │ HOW: 実装            │      ║      ┃
┃  ║  │ - Domain Model   │              │ - コード             │      ║      ┃
┃  ║  │ - API仕様        │              │ - テスト             │      ║      ┃
┃  ║  │ - 【実装UC詳細】 │              │                      │      ║      ┃
┃  ║  └──────────────────┘              └──────────────────────┘      ║      ┃
┃  ╚══════════════════════════════════════════════════════════════════╝      ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

---

## 2. Value Stream（価値の流れ）全体像

### 2.1 顧客状態遷移モデル

Value Stream は「顧客の状態遷移」として定義されます。組織の活動ではなく、顧客がどのような状態を経て価値を享受するかを表現します。

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    Value Stream: 顧客状態遷移                               ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃                                                                             ┃
┃  VS0          VS1          VS2          VS3          VS4                   ┃
┃  潜在ニーズ    認知到達      選好形成      意思決定      価値獲得            ┃
┃  ┌─────┐     ┌─────┐     ┌─────┐     ┌─────┐     ┌─────┐                  ┃
┃  │ 💭  │ ──→ │ 👀  │ ──→ │ 💡  │ ──→ │ ✋  │ ──→ │ 🎁  │                  ┃
┃  │気づき│     │知る │     │欲しい│     │決める│     │得る │                  ┃
┃  │前   │     │     │     │     │     │     │     │     │                  ┃
┃  └─────┘     └─────┘     └─────┘     └─────┘     └─────┘                  ┃
┃                                                       │                     ┃
┃                                                       ↓                     ┃
┃                                        VS5          VS6          VS7       ┃
┃                                        価値実感      価値継続      価値共創  ┃
┃                                        ┌─────┐     ┌─────┐     ┌─────┐    ┃
┃                                        │ 😊  │ ──→ │ 🔄  │ ──→ │ 📢  │    ┃
┃                                        │使う │     │続ける│     │薦める│    ┃
┃                                        │     │     │     │     │     │    ┃
┃                                        └─────┘     └─────┘     └─────┘    ┃
┃                                                                             ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

### 2.2 Value Stage 定義一覧

| VS | 顧客状態 | 顧客視点の定義 | 組織側の対応活動例 |
|----|----------|----------------|-------------------|
| **VS0** | 潜在ニーズ状態 | 「まだ気づいていないが、この価値を必要としている」 | 市場調査、ニーズ発掘 |
| **VS1** | 認知到達状態 | 「この価値の存在を知る」 | マーケティング、広告、PR |
| **VS2** | 選好形成状態 | 「この価値を選びたいと思う」 | 製品開発、ブランディング |
| **VS3** | 意思決定状態 | 「この価値を獲得することを決める」 | 営業、提案、見積 |
| **VS4** | 価値獲得状態 | 「この価値を手に入れる」 | 受注、出荷、納品 |
| **VS5** | 価値実感状態 | 「この価値を実感している」 | 導入支援、利用サポート |
| **VS6** | 価値継続状態 | 「この価値を継続的に享受している」 | 保守、更新、追加提案 |
| **VS7** | 価値共創状態 | 「この価値を他者と共有・推奨している」 | コミュニティ、紹介制度 |

### 2.3 業界別 Value Stream 例

#### 例1: 飲料メーカー（B2C）

```
┌────────────────────────────────────────────────────────────────────────────┐
│                     飲料メーカー Value Stream                               │
├──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┤
│ VS0  │ VS1  │ VS2  │ VS3  │ VS4  │ VS5  │ VS6  │ VS7  │
│潜在  │認知  │選好  │決定  │獲得  │実感  │継続  │共創  │
├──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┤
│喉が  │CMで  │美味  │店頭  │購入  │飲用  │リピ  │SNS   │
│渇く  │知る  │しそう│で選ぶ│する  │する  │ート  │で紹介│
│前   │      │      │      │      │      │購入  │      │
└──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘
         ↑              ↑              ↑              ↑
    マーケ         製品開発        物流・販売     顧客サービス
    ティング       品質管理        在庫管理       コミュニティ
```

#### 例2: 人材派遣会社（B2B2C）

```
┌────────────────────────────────────────────────────────────────────────────┐
│                     人材派遣会社 Value Stream                               │
│                                                                            │
│  【求職者向け】                                                             │
│  ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┐              │
│  │ VS0  │ VS1  │ VS2  │ VS3  │ VS4  │ VS5  │ VS6  │ VS7  │              │
│  │転職  │派遣  │この  │登録  │派遣  │就業  │継続  │友人  │              │
│  │検討前│会社を│会社が│決定  │決定  │中   │就業  │紹介  │              │
│  │      │知る  │良さそう│      │      │      │      │      │              │
│  └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘              │
│                                                                            │
│  【企業向け】                                                               │
│  ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┐              │
│  │ VS0  │ VS1  │ VS2  │ VS3  │ VS4  │ VS5  │ VS6  │ VS7  │              │
│  │人手  │派遣  │条件  │発注  │人材  │活用  │継続  │他部署│              │
│  │不足前│会社を│が合う│決定  │受入  │中   │発注  │紹介  │              │
│  │      │知る  │      │      │      │      │      │      │              │
│  └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘              │
└────────────────────────────────────────────────────────────────────────────┘
```

#### 例3: 地方銀行（B2B + B2C）

```
┌────────────────────────────────────────────────────────────────────────────┐
│                      地方銀行 Value Stream                                  │
│                                                                            │
│  【個人向け（預金・ローン）】                                               │
│  ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┐              │
│  │ VS0  │ VS1  │ VS2  │ VS3  │ VS4  │ VS5  │ VS6  │ VS7  │              │
│  │資産  │銀行  │この  │口座  │口座  │利用  │メイン│家族  │              │
│  │形成前│認知  │銀行が│開設  │開設  │中   │バンク│紹介  │              │
│  │      │      │良さそう│決定  │完了  │      │化   │      │              │
│  └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘              │
│                                                                            │
│  【法人向け（融資）】                                                       │
│  ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┐              │
│  │ VS0  │ VS1  │ VS2  │ VS3  │ VS4  │ VS5  │ VS6  │ VS7  │              │
│  │資金  │銀行  │融資  │審査  │融資  │事業  │追加  │取引先│              │
│  │需要前│認知  │相談  │申込  │実行  │成長  │融資  │紹介  │              │
│  │      │      │      │      │      │      │      │      │              │
│  └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘              │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. VS-Swimlane モデル

Value Stage を「時間文脈を持つオペレーションフェーズ」として解釈し、Capability/Operation を配置します。

**設計原則**: Core は時間文脈を持つため Swimlane 内に配置、Supporting/Generic は時間文脈を持たないため横断レイヤーとして分離します。

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    VS-Swimlane モデル                                       ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃                                                                             ┃
┃  【Core Layer: 時間文脈を持つ顧客接点活動】                                 ┃
┃                          時間軸（Time）→                                    ┃
┃  ┌──────────┬──────────┬──────────┬──────────┬──────────┬──────────┐      ┃
┃  │   VS1    │   VS2    │   VS3    │   VS4    │   VS5    │   VS6    │      ┃
┃  │  認知    │  選好    │  決定    │  獲得    │  実感    │  継続    │      ┃
┃  ├──────────┼──────────┼──────────┼──────────┼──────────┼──────────┤      ┃
┃  │  Core:   │  Core:   │  Core:   │  Core:   │  Core:   │  Core:   │      ┃
┃  │ マーケ   │ 製品開発 │ セールス │ 出荷管理 │ サポート │  保守    │      ┃
┃  │ ティング │    │     │    ↑     │          │          │          │      ┃
┃  │          │    └─────┼────┘     │          │          │          │      ┃
┃  │          │      参照（製品情報）│          │          │          │      ┃
┃  └──────────┴──────────┴──────────┴──────────┴──────────┴──────────┘      ┃
┃                              ↕ 利用                                         ┃
┃  ┌─────────────────────────────────────────────────────────────────────┐   ┃
┃  │【Supporting Layer: VStr横断支援】                                    │   ┃
┃  │  データ基盤 │ 物流基盤 │ 分析基盤 │ 品質管理                         │   ┃
┃  │  ※ 時間に沿って進化: v1 ──→ v2 ──→ v3                              │   ┃
┃  └─────────────────────────────────────────────────────────────────────┘   ┃
┃                              ↕ 利用                                         ┃
┃  ┌─────────────────────────────────────────────────────────────────────┐   ┃
┃  │【Generic Layer: 組織横断基盤】                                       │   ┃
┃  │  認証 │ 経理 │ HR │ IT運用 │ セキュリティ                            │   ┃
┃  │  ※ 全VStr・全VSで共通（時間文脈なし）                               │   ┃
┃  └─────────────────────────────────────────────────────────────────────┘   ┃
┃                                                                             ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

### VS-Swimlane の3つの特性

| 特性 | 説明 | 例 |
|------|------|-----|
| **時間性** | VSは時間文脈を提供、Core Capabilityは時間順に配置 | VS2の製品開発 → VS3のセールス |
| **文脈最適化** | 同じCapabilityでもVS文脈で具体Operationが異なる | 各VSで最適化されたOperation |
| **参照可能性** | 先行VSで確立したCapabilityを後続VSが参照・再利用 | VS2の製品情報をVS3が参照 |

### レイヤー分離の理由

| レイヤー | 時間文脈 | 配置 | 理由 |
|----------|---------|------|------|
| **Core** | あり | Swimlane内（VS列） | 特定VSに紐付く顧客接点活動 |
| **Supporting** | なし | 横断レイヤー | VStr全体を支援、時間ではなく依存関係で表現 |
| **Generic** | なし | 横断レイヤー | 組織全体の基盤、全VStr共通 |

### 発展パターン: 多段VStr

Supportingを独立したValue Streamとして設計する「多段VStrパターン」も利用可能です。
従業員体験（EX）やパートナー体験（PX）を明示的に設計したい場合に有効です。

詳細: `_patterns/_axes/multi-tier-vstr-axis.md`

---

## 4. ユースケースの階層と配置

### 4.1 ビジネスUC vs 実装UC

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                   Use Case の階層と配置                                     ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃                              ┃                                             ┃
┃   ビジネスユースケース        ┃    実装ユースケース                         ┃
┃   (Business Use Case)        ┃    (Implementation Use Case)               ┃
┃                              ┃                                             ┃
┃   Phase 3 CL3: Operation     ┃    Phase 4以降: BC内Use Case               ┃
┃                              ┃                                             ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃                              ┃                                             ┃
┃  【目的】                    ┃  【目的】                                   ┃
┃  ビジネス活動を定義          ┃  ソフトウェア機能を定義                     ┃
┃                              ┃                                             ┃
┃  【主語】                    ┃  【主語】                                   ┃
┃  業務アクター（人・組織）    ┃  システムアクター（ユーザー・外部システム） ┃
┃                              ┃                                             ┃
┃  【粒度】                    ┃  【粒度】                                   ┃
┃  業務プロセス単位            ┃  画面操作・API呼び出し単位                  ┃
┃                              ┃                                             ┃
┃  【例】                      ┃  【例】                                     ┃
┃  「顧客が見積もりを依頼する」┃  「見積依頼フォームを表示する」             ┃
┃  「営業が商談を進める」      ┃  「見積APIを呼び出す」                      ┃
┃  「製造が発酵状況を監視する」┃  「発酵データをダッシュボードに表示する」   ┃
┃                              ┃                                             ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

### 4.2 ユースケースの導出フロー

```
Phase 3 CL3                      Phase 4                       Phase 5
┌─────────────────┐             ┌─────────────────┐           ┌─────────────────┐
│ ビジネスUC      │             │ BC定義          │           │ 実装UC詳細      │
│                 │             │                 │           │                 │
│ 「顧客が見積を  │    ──→     │ Bounded Context │    ──→    │ UC: 見積作成    │
│   依頼する」    │             │ 見積管理BC      │           │ ├─ 画面: 入力   │
│                 │             │                 │           │ ├─ API: POST    │
│ 「営業が見積を  │             │ ┌─────────────┐ │           │ ├─ 検証ルール   │
│   作成する」    │             │ │ 実装UC概要  │ │           │ └─ エラー処理   │
│                 │             │ │ - 見積作成  │ │           │                 │
│ 「顧客が見積を  │             │ │ - 見積承認  │ │           │ UC: 見積承認    │
│   承認する」    │             │ │ - 見積参照  │ │           │ ├─ 画面: 確認   │
│                 │             │ └─────────────┘ │           │ ├─ API: PATCH   │
└─────────────────┘             └─────────────────┘           └─────────────────┘

   業務プロセス視点                サービス境界確定               ソフトウェア機能視点
```

---

## 5. Phase別成果物一覧（V5.1）

### 5.1 概要表

```
┏━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Phase ┃ Level     ┃ 主要概念              ┃ 成果物ディレクトリ              ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃   1   ┃ 前提      ┃ Context               ┃ outputs/1-context/              ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃   2   ┃ L1        ┃ Value Stage (VS)      ┃ outputs/2-value/                ┃
┃       ┃ ビジネス層┃ Value Stream (VStr)   ┃                                 ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃   3   ┃ L2        ┃ CL1/CL2/CL3           ┃ outputs/3-capabilities/         ┃
┃       ┃ サービス層┃ 【ビジネス観点】      ┃                                 ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃   4   ┃ L2→L3    ┃ BC確定・Context Map   ┃ outputs/4-architecture/         ┃
┃       ┃ 境界確定  ┃ Capability-BC対応     ┃                                 ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃   5   ┃ L3        ┃ パラソルドメイン言語  ┃ outputs/5-software/             ┃
┃       ┃ 実装層    ┃ API/DB/テスト定義     ┃                                 ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃   6   ┃ L3        ┃ Implementation        ┃ services/{service}/             ┃
┃       ┃ 実装      ┃                       ┃                                 ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃   7   ┃ 基盤      ┃ Platform              ┃ infrastructure/                 ┃
┗━━━━━━━┻━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

### 5.2 統一ディレクトリ構造（V5.1標準）

```
projects/{project}/outputs/
│
├── 1-context/                              # Phase 1: Context
│   ├── organization-analysis.md            #   組織分析
│   ├── market-assessment.md                #   市場評価
│   └── stakeholder-map.md                  #   ステークホルダー
│
├── 2-value/                                # Phase 2: Value Definition
│   ├── value-streams-mapping.md            #   VStr全体マッピング
│   └── vs{N}-detail.md                     #   各VS詳細（vs0, vs1...vs7）
│
├── 3-capabilities/                         # Phase 3: Capability（ビジネス観点）
│   └── {vs-slug}/                          #   VS毎のディレクトリ
│       ├── cl1-domain-classification.md    #   CL1: Core/Supporting/Generic
│       ├── cl2-subdomain-design.md         #   CL2: ケイパビリティ設計
│       └── cl3-business-operations/        #   CL3: 業務オペレーション
│           └── {capability}-operations.md  #        各ケイパビリティの業務活動
│
├── 4-architecture/                         # Phase 4: Application Design
│   ├── capability-bc-mapping.md            # ★ CL2-BC対応表（必須）
│   ├── context-map.md                      #   BC間関係（U/D, ACL等）
│   └── services/
│       └── {service}/
│           └── bounded-contexts.md         #   サービス内BC一覧
│
└── 5-software/                             # Phase 5: Software Design
    └── {service}/                          #   サービス（デプロイ単位）
        └── {bc-name}/                      # ★ BCが設計単位（kebab-case）
            │
            ├── domain-language.md          #   パラソルドメイン言語（SSOT）
            ├── api-specification.md        #   API仕様
            ├── database-design.md          #   DB設計（生成物）
            │
            ├── operations/                 #   オペレーション群
            │   └── {operation-name}/
            │       ├── operation.md        #   オペレーション定義
            │       └── actor-usecases/     #   Actor UseCase群
            │           └── {auc-name}/     #   Actor UseCase
            │               ├── actor-usecase.md
            │               ├── robustness.md
            │               └── views/      #   View群
            │                   └── {view}.md
            │
            └── tests/                      # ★ テスト定義（設計側）
                │
                ├── _bc-release-criteria.yaml  # BCリリース基準
                ├── shared/                    # BC共通（ドメインモデル）
                │   └── unit-spec.yaml         #   ← domain-language.mdから生成
                │
                └── {operation-name}/          # ★ オペレーション単位（イテレーション）
                    ├── _done-criteria.yaml    #   オペレーション完了基準
                    ├── api-spec.yaml          #   ← operation.mdから生成
                    ├── ui-spec.yaml           #   ← views/*.mdから生成
                    └── integration-spec.yaml  #   ← actor-usecases/*.mdから生成
```

### 5.3 実装側ディレクトリ構造

```
services/{service}/                         # Phase 6: Implementation
├── src/
│   └── {bc-name}/                          #   BC単位のソースコード
│       ├── domain/                         #   ドメイン層
│       ├── application/                    #   アプリケーション層
│       ├── infrastructure/                 #   インフラ層
│       └── presentation/                   #   プレゼンテーション層
│
└── tests/                                  # ★ テスト実装（実装側）
    └── {bc-name}/
        ├── shared/                         #   BC共通テスト
        │   └── unit/                       #   ドメインモデルのユニットテスト
        │
        └── {operation-name}/               # ★ オペレーション単位（イテレーション）
            ├── unit/                       #   オペレーション固有
            ├── contract/                   #   API契約テスト
            ├── component/                  #   UIコンポーネント
            └── integration/                #   ユースケース統合
```

### 5.4 イテレーションとリリースの関係（V5.2）

```
┌─────────────────────────────────────────────────────────────────┐
│ BC: product-catalog                          【リリース単位】    │
│                                                                 │
│  イテレーション1        イテレーション2        イテレーション3   │
│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐     │
│  │create-product│  →   │search-products│  →  │manage-categories│ │
│  │             │      │             │      │             │     │
│  │ 設計→実装   │      │ 設計→実装   │      │ 設計→実装   │     │
│  │ テスト→DoD │      │ テスト→DoD │      │ テスト→DoD │     │
│  └─────────────┘      └─────────────┘      └─────────────┘     │
│       ✅ done              ✅ done              🔄 進行中       │
│                                                                 │
│  ──────────────────────────────────────────────────────────────│
│  _bc-release-criteria.yaml                                      │
│  ├── all_operations_done: false                                 │
│  ├── shared_tests_pass: true                                    │
│  └── release_ready: false  ← 全オペレーション完了でtrue         │
└─────────────────────────────────────────────────────────────────┘
```

### 5.5 Phase間のトレーサビリティ

```
Phase 2: VS定義
    │
    │ value-streams-mapping.md
    │   └── VS2: 製品開発（選好形成）
    ▼
Phase 3: Capability分解（ビジネス観点）
    │
    │ cl2-subdomain-design.md
    │   └── Capability: fermentation-research
    │
    │ cl3-business-operations/fermentation-research-operations.md
    │   └── Operations: 菌株培養、発酵モニタリング
    ▼
Phase 4: BC確定（アーキテクチャ観点）
    │
    │ capability-bc-mapping.md
    │   └── fermentation-research → fermentation-bc
    │
    │ context-map.md
    │   └── fermentation-bc ←[U/D]→ quality-bc
    ▼
Phase 5: ソフトウェア設計
    │
    │ fermentation-bc/domain-language.md
    │   └── Aggregates: Strain, FermentationBatch
    │
    │ fermentation-bc/tests/unit-spec.yaml
    │   └── test cases for domain model
    ▼
Phase 6: 実装
    │
    │ services/brewing-service/tests/unit/fermentation-bc/
    │   └── test_strain.py, test_fermentation_batch.py
```

詳細: `_software-design-reference/capability-bc-test-structure.md`

---

## 6. 用語マッピング（DDD対応）

| Parasol概念 | Phase | DDD用語 | 説明 |
|-------------|-------|---------|------|
| Value Stage (VS) | 2 | ≈ Domain | 顧客状態として定義 |
| Value Stream (VStr) | 2 | - | VS0→VS7の価値の流れ全体 |
| Capability Domain (CD) | 3 CL1 | - | Core/Supporting/Generic分類 |
| Capability (Cap) | 3 CL2 | ≈ Subdomain | サービス候補、チーム境界 |
| Operation (Op) | 3 CL3 | ≈ Use Case | ビジネスユースケース |
| Bounded Context | 4 | Bounded Context | サービス境界確定 |
| Actor UseCase | 4-5 | Use Case | 単一ユーザの完結操作（実装単位） |
| Domain Model | 5 | Aggregates, Entities | 実装設計 |

---

## 6.1 アジャイル開発との対応

パラソルの設計階層はアジャイル開発のバックログ項目と対応します：

```
┌─────────────────────────────────────────────────────────────────┐
│              パラソル → アジャイル マッピング                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ビジネスオペレーション  ══════►  Epic / Feature                 │
│  （CL3で定義）                  （複数スプリント）               │
│          │                                                      │
│          ▼                                                      │
│  Actor UseCase          ══════►  User Story ★                  │
│  （Phase 4-5で定義）            （1スプリント内完了）            │
│          │                                                      │
│          ▼                                                      │
│  View                   ══════►  Task                           │
│  （Phase 5で定義）              （実装タスク）                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Actor UseCase = User Story

**Actor UseCaseがUser Storyに最適な理由**:

| INVEST原則 | Actor UseCaseでの実現 |
|------------|----------------------|
| **I**ndependent | 他と独立して実装・テスト可能 |
| **N**egotiable | スコープ調整可能 |
| **V**aluable | ユーザーにとって意味のある成果 |
| **E**stimable | 明確な範囲と完了条件 |
| **S**mall | 1スプリントで完了可能な粒度 |
| **T**estable | 基本/代替/例外フローで検証可能 |

### ビジネスオペレーション ≠ ユースケース

**重要な区別**:
- **ビジネスオペレーション**: 複数アクターが協調する業務活動 → **Epic/Feature**
- **Actor UseCase**: 単一ユーザの完結操作 → **User Story**

詳細: `_software-design-reference/business-operations.md` の「アジャイル開発との対応関係」セクション

---

## 6.2 Bounded Context と CL3 の関係

### BCは「活動境界」

Bounded Context（BC）の本質は**活動の境界**です。

```
┌─────────────────────────────────────────────────────────────────────┐
│                    BCの本質理解                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  従来の説明              より本質的な理解                            │
│  「言語の境界」    →    「活動の境界」                               │
│                                                                     │
│  言語が異なるのは結果    活動が異なるから言語も異なる                 │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────┐       │
│  │ 活動が違う → 関心事が違う → 使う言葉の意味が違う        │       │
│  │     ↑                              ↓                    │       │
│  │   原因                           結果（言語境界）        │       │
│  └─────────────────────────────────────────────────────────┘       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**例: 「注文」という言葉**
- **販売BC**: 顧客との約束（価格・納期）
- **在庫BC**: 引当対象（数量・ロケーション）
- **経理BC**: 売上計上対象（金額・勘定科目）

同じ「注文」でも、**活動が違うから意味が違う**。

### BC と CL3 の包含関係

```
┌─────────────────────────────────────────────────────────────────────┐
│                     BC と CL3 の関係                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Bounded Context (BC) = 活動境界                                    │
│  ├── 関心事が一貫する範囲（同じ言葉が同じ意味を持つ）               │
│  ├── チーム所有の単位                                               │
│  └── マイクロサービスの候補                                         │
│          │                                                          │
│          │ 包含関係（1 BC : N CL3）                                 │
│          ▼                                                          │
│  CL3: ビジネスオペレーション = 活動                                  │
│  ├── BC内で実行される業務操作の単位                                 │
│  ├── 複数アクターが協調する活動                                     │
│  └── Epic/Feature レベルの粒度                                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 具体例

```
BC「受注管理」（活動境界）
├── CL3「見積作成オペレーション」（活動）
│   ├── Actor UseCase: 見積書を作成する
│   ├── Actor UseCase: 見積承認を依頼する
│   └── Actor UseCase: 見積承認を実行する
│
├── CL3「受注処理オペレーション」（活動）
│   ├── Actor UseCase: 注文を登録する
│   ├── Actor UseCase: 在庫を引き当てる
│   └── Actor UseCase: 受注確認を送信する
│
└── CL3「出荷指示オペレーション」（活動）
    ├── Actor UseCase: 出荷指示を作成する
    └── Actor UseCase: 配送業者を手配する
```

### 比較表

| 観点 | BC（活動境界） | CL3（活動） |
|------|---------------|-------------|
| **定義** | 活動の境界（関心事の範囲） | 境界内で行われる業務活動 |
| **比喩** | 部屋の壁 | 部屋の中での作業 |
| **粒度** | サブドメイン単位 | Epic/Feature単位 |
| **決定基準** | 同じ言葉が同じ意味を持つ範囲 | 業務目的の完結単位 |
| **技術対応** | マイクロサービス候補 | API群/モジュール |
| **Phase** | Phase 4で確定 | Phase 3で定義 |

### 設計フローでの関係

| Phase | 作業 | 成果物 |
|-------|------|--------|
| Phase 3 | CL3を洗い出す | ビジネスオペレーション一覧 |
| Phase 4 | CL3をBC境界に配置 | Context Map、BC定義 |

Phase 3でCL3（活動）を洗い出し、Phase 4でそれらをBC（活動境界）にマッピングします。

### CL2・BC・CL3 の境界役割の整理

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    CL2・BC・CL3 の境界役割                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  CL2: ケイパビリティ（チーム境界）                                   │   │
│  │  ─────────────────────────────────────────────────────────────────  │   │
│  │  ・組織的境界（人の境界）                                           │   │
│  │  ・チーム編成の単位                                                 │   │
│  │  ・複数のBCを所有することがある                                     │   │
│  │  例：「受注管理チーム」                                             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              │ 1:N（1チームが複数BCを所有可能）            │
│                              ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  BC: Bounded Context（マイクロサービス境界）                         │   │
│  │  ─────────────────────────────────────────────────────────────────  │   │
│  │  ・技術的境界（システムの境界）                                      │   │
│  │  ・API境界・DB境界・デプロイ単位                                     │   │
│  │  ・1 BC ≒ 1 マイクロサービス（原則）                                │   │
│  │  例：order-service、quote-service                                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              │ 1:N（1BCが複数CL3を包含）                   │
│                              ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  CL3: Business Operation（業務ロジック群）                           │   │
│  │  ─────────────────────────────────────────────────────────────────  │   │
│  │  ・ビジネスロジックの単位                                            │   │
│  │  ・BC内のAPI群・モジュール群として実装                               │   │
│  │  ・Epic/Feature レベル                                               │   │
│  │  例：見積作成機能、受注処理機能                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 境界の種類と役割

| 概念 | 境界の種類 | 役割 | 技術的対応 |
|------|-----------|------|-----------|
| **CL2** | 組織境界（人） | チーム編成・責任範囲 | チーム、プロダクトオーナー |
| **BC** | 技術境界（システム） | デプロイ・変更範囲 | **マイクロサービス**、DB |
| **CL3** | ロジック境界（機能） | 業務機能群 | API群、モジュール |

### 具体例：CL2・BC・CL3 の関係

```
CL2: 受注管理チーム（チーム境界）
│
├── BC: order-service（マイクロサービス境界）
│   ├── CL3: 受注処理オペレーション
│   │   ├── API: POST /orders
│   │   └── API: GET /orders/{id}
│   └── CL3: 受注変更オペレーション
│       └── API: PUT /orders/{id}
│
├── BC: quote-service（マイクロサービス境界）
│   └── CL3: 見積作成オペレーション
│       ├── API: POST /quotes
│       └── API: GET /quotes/{id}
│
└── BC: shipping-service（マイクロサービス境界）
    └── CL3: 出荷指示オペレーション
        └── API: POST /shipments
```

**ポイント**:
- **1つのCL2（チーム）** が **複数のBC** を所有
- **1つのBC** が **複数のCL3（業務機能）** を包含

### BC とマイクロサービスの関係

BCとマイクロサービスの対応は **1:1 とは限らない**：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  BC と マイクロサービスの対応パターン                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【パターン1】1 BC = 1 マイクロサービス（理想形）                            │
│  ──────────────────────────────────────────────────────────────────────    │
│    BC: order-context  →  order-service                                     │
│    BC: quote-context  →  quote-service                                     │
│    BC: shipping-context → shipping-service                                 │
│                                                                             │
│    適用：チームが十分にある、BCが十分に複雑                                 │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【パターン2】N BC = 1 マイクロサービス（統合型）                            │
│  ──────────────────────────────────────────────────────────────────────    │
│    ┌─────────────────────────────────────────┐                             │
│    │  sales-service                          │                             │
│    │  ├── BC: order-context（注文）          │                             │
│    │  ├── BC: quote-context（見積）          │                             │
│    │  └── BC: shipping-context（出荷）       │                             │
│    └─────────────────────────────────────────┘                             │
│                                                                             │
│    適用：小規模チーム、関連性の高いBC、運用コスト削減                        │
│    注意：BC境界（言語境界）はコード内で維持すること                          │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【パターン3】1 BC = N マイクロサービス（分割型）                            │
│  ──────────────────────────────────────────────────────────────────────    │
│    BC: order-context                                                       │
│    ├── order-command-service（書き込み）                                   │
│    └── order-query-service（読み取り）                                     │
│                                                                             │
│    適用：CQRS、スケーラビリティ要件、特殊なパフォーマンス要件               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

| パターン | BC : サービス | 適用場面 | 注意点 |
|----------|--------------|---------|--------|
| **理想形** | 1:1 | 十分なチーム規模、BC独立性高い | - |
| **統合型** | N:1 | 小規模チーム、関連BC、コスト削減 | BC境界をコード内で維持 |
| **分割型** | 1:N | CQRS、スケーラビリティ要件 | BC内の整合性確保 |

**設計指針**:
- **BC境界（言語境界）は常に維持** → 同じBCなら同じ用語の意味
- **サービス境界は運用判断** → チーム規模・コスト・スケーラビリティで決定
- **将来の分割を想定** → 統合型でもBC境界をコードで明確に

### BC→サービスマッピング設計工程（Phase 4内）

BC定義後、サービス境界を論理的に決定するための5ステップ：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  BC→サービスマッピング設計工程（5ステップ）                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Step 1: BC棚卸し                                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ・全BCの責務・エンティティ数・予想変更頻度を整理                      │   │
│  │ ・成果物: bc-inventory.md                                            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  Step 2: Context Map作成 ★論理設計                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ・BC間の関係パターンを定義（論理的な統合戦略）                        │   │
│  │ ・Upstream/Downstream の依存方向を明示                                │   │
│  │ ・統合パターン選択（下表参照）                                        │   │
│  │ ・成果物: context-map.md                                             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  Step 3: 依存関係分析（技術観点）                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ・Context Mapを基に技術的な依存を詳細分析                             │   │
│  │ ・結合度をスコアリング（強整合性必須/結果整合性/なし）                │   │
│  │ ・成果物: bc-dependency-matrix.md                                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  Step 4: チーム境界照合                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ・CL2（チーム境界）とBC境界の整合を確認                               │   │
│  │ ・チームサイズ・スキルセットを考慮                                    │   │
│  │ ・成果物: team-bc-alignment.md                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  Step 5: サービスマッピング決定 ★物理設計                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ・判断フローに従いパターン選択（1:1 / N:1 / 1:N）                     │   │
│  │ ・設計ストーリー（なぜそうしたか）を記録                              │   │
│  │ ・将来の分離/統合トリガーを定義                                       │   │
│  │ ・成果物: bc-service-mapping.md                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Context Map と サービスマッピングの関係

```
┌─────────────────────────────────────────────────────────────────────────────┐
│              論理設計（Context Map）→ 物理設計（サービスマッピング）          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【Step 2: Context Map】論理的なBC間関係                                    │
│  ───────────────────────────────────────────────────────────────────────   │
│  ・BC間の「どう連携するか」を決める                                         │
│  ・チーム間のコミュニケーション契約                                         │
│  ・技術選択に依存しない                                                     │
│                                                                             │
│                    ↓ 制約条件として入力                                     │
│                                                                             │
│  【Step 5: サービスマッピング】物理的なデプロイ単位                          │
│  ───────────────────────────────────────────────────────────────────────   │
│  ・BC→サービスの「どう配置するか」を決める                                  │
│  ・運用・コスト・スケーラビリティを考慮                                     │
│  ・Context Mapの関係パターンを実装レベルで具体化                            │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  【なぜこの順序か】                                                         │
│                                                                             │
│  ✅ 論理 → 物理 の順序で設計することで：                                   │
│     ・BC間の関係が明確になってから配置を決められる                          │
│     ・統合パターン（ACL等）がサービス境界の制約になる                        │
│     ・論理的整合性を保ったまま物理設計できる                                │
│                                                                             │
│  ❌ 物理 → 論理 だと：                                                     │
│     ・サービス境界が先に決まり、論理設計が歪む                              │
│     ・「このサービスに入れたから」という物理都合で統合戦略が決まる          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Context Map の統合パターン（Step 2で選択）

| パターン | 関係 | 説明 | 適用場面 |
|----------|------|------|----------|
| **Partnership** | 対等 | 両チームが協調して成功・失敗 | 密接に連携するBC |
| **Shared Kernel** | 共有 | コード/モデルの一部を共有 | 共通ドメインロジック |
| **Customer-Supplier** | 上下流 | Upstream(供給者)がDownstream(顧客)に合わせる | API提供側と利用側 |
| **Conformist** | 従属 | Downstreamが Upstreamに完全に従う | 外部システム連携 |
| **Anti-Corruption Layer (ACL)** | 防御 | 変換層で外部モデルから保護 | レガシー連携 |
| **Open Host Service** | 公開 | 標準化されたプロトコルで公開 | 複数消費者向けAPI |
| **Published Language** | 標準 | 共通の交換フォーマット | イベント駆動連携 |
| **Separate Ways** | 分離 | 統合しない（各自で実装） | 重複許容時 |

### Context Map 図の例

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Context Map 例                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    ┌──────────────┐                    ┌──────────────┐                    │
│    │  Order BC    │                    │  Payment BC  │                    │
│    │  (受注)       │ ──── Customer ──→ │  (決済)       │                    │
│    │              │      Supplier      │              │                    │
│    └──────────────┘                    └──────────────┘                    │
│           │                                   │                             │
│           │ Open Host                         │ ACL                         │
│           │ Service                           │                             │
│           ▼                                   ▼                             │
│    ┌──────────────┐                    ┌──────────────┐                    │
│    │ Inventory BC │                    │ External     │                    │
│    │  (在庫)       │                    │ Payment GW   │                    │
│    │              │                    │ (外部決済)    │                    │
│    └──────────────┘                    └──────────────┘                    │
│                                                                             │
│    凡例:                                                                    │
│    ──→ : Upstream → Downstream（データ・イベントの流れ）                    │
│    Customer-Supplier : 下流のニーズに上流が対応                              │
│    Open Host Service : 標準APIとして公開                                    │
│    ACL : 腐敗防止層で外部から保護                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### サービス分割判断フロー

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      サービス分割判断フローチャート                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  START: BC定義完了                                                          │
│    │                                                                        │
│    ▼                                                                        │
│  ┌────────────────────────────────────┐                                    │
│  │ Q1: 専任チーム（5-8名）が存在？     │                                    │
│  └──────────────┬─────────────────────┘                                    │
│          YES    │    NO                                                     │
│           │     └─────────┐                                                 │
│           │               ▼                                                 │
│           │     ┌─────────────────────┐                                    │
│           │     │ 1チームで複数BC？    │                                    │
│           │     └──────────┬──────────┘                                    │
│           │          YES   │   NO                                           │
│           │           │    └→ 組織設計と同時検討                           │
│           │           ▼                                                     │
│           │     【統合型候補】                                              │
│           │                                                                 │
│           ▼                                                                 │
│  ┌────────────────────────────────────┐                                    │
│  │ Q2: BC間のデータ依存は？            │                                    │
│  └──────────────┬─────────────────────┘                                    │
│     強整合性必須 │ 結果整合性でOK │ なし/弱い                               │
│           │     │                │                                          │
│           ▼     ▼                ▼                                          │
│     【統合型】  【標準候補1:1】  【分離候補】                               │
│                                                                             │
│  ┌────────────────────────────────────┐                                    │
│  │ Q3: スケーラビリティ要件は？        │                                    │
│  └──────────────┬─────────────────────┘                                    │
│       同程度    │ 10倍以上異なる                                            │
│           │     │                                                           │
│           ▼     ▼                                                           │
│     【統合可能】【分割型1:N】（CQRS等）                                     │
│                                                                             │
│  ┌────────────────────────────────────┐                                    │
│  │ Q4: デプロイ独立性は必要？          │                                    │
│  └──────────────┬─────────────────────┘                                    │
│       不要      │ 必要                                                      │
│           │     │                                                           │
│           ▼     ▼                                                           │
│     【統合型】  【分離推奨1:1】                                             │
│                                                                             │
│  RESULT: パターン決定 → bc-service-mapping.md に記録                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### サービス分割判断基準（定量的）

| 観点 | 指標 | 1:1（理想） | N:1（統合） | 1:N（分割） |
|------|------|-------------|-------------|-------------|
| **チームサイズ** | BC担当人数 | 5-8名 | <5名で複数BC | >12名 |
| **変更頻度** | 月間変更回数 | 同程度 | 同期的に変更 | 10倍以上の差 |
| **トラフィック** | RPS | 同程度 | 同程度 | 100倍以上の差 |
| **SLA要件** | 可用性目標 | 同程度 | 同程度 | 異なる |

### トレードオフ比較

| パターン | メリット | デメリット | 適用条件 |
|----------|----------|------------|----------|
| **1:1理想形** | 独立デプロイ、障害分離、スケール自由 | 運用コスト増 | 専任チーム、独立した変更頻度 |
| **N:1統合型** | 運用コスト削減、強整合性容易、立上げ速い | 単一障害点、BC境界曖昧化リスク | 小規模チーム、関連BC、MVP |
| **1:N分割型** | 独立スケール、障害分離、技術最適化 | 分散トランザクション複雑化 | CQRS、極端なスケール差 |

### 1:1を選ぶべき条件チェックリスト

```
┌─────────────────────────────────────────────────────────────────┐
│                   1:1 が最適な条件                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  □ 専任チーム（5-8名）が存在する                               │
│  □ BCの責務が明確で独立している                                │
│  □ 結果整合性で十分（強整合性不要）                            │
│  □ デプロイ独立性が必要                                        │
│  □ スケーラビリティ要件が独立している                          │
│  □ 変更頻度が異なる（独立リリースサイクル）                    │
│                                                                 │
│  → 4つ以上該当: 1:1 を強く推奨                                  │
│  → 2-3つ該当: 1:1 を検討                                       │
│  → 1つ以下: 統合型を検討                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 設計プロセスと最終構造の関係

```
┌─────────────────────────────────────────────────────────────────────────────┐
│              設計プロセス（時間軸）vs 最終構造（包含関係）                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【設計プロセス】Phase順序                                                  │
│  ──────────────────────────────────────────────────────────────────────    │
│                                                                             │
│    Phase 3: CL3を洗い出す（業務活動の発見）                                 │
│        ↓ 活動パターンを分析                                                │
│    Phase 4: BC境界を発見・確定（活動境界の特定）                            │
│        ↓                                                                   │
│    Phase 5: Actor UC / View を詳細化                                        │
│                                                                             │
│    ※ CL3を先に理解してからBC境界を「発見」する（発見的アプローチ）          │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【最終構造】包含関係                                                       │
│  ──────────────────────────────────────────────────────────────────────    │
│                                                                             │
│    CL2（チーム境界）                                                        │
│    └── BC（マイクロサービス境界）← システムの実装単位                       │
│        └── CL3（業務ロジック群）← BC内のAPI・モジュール                     │
│            └── Actor UseCase（ユーザ操作）← 個別API                         │
│                └── View（UI画面）                                           │
│                                                                             │
│    ※ 最終的には BC ⊃ CL3（BCがCL3を包含）                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### CL3-BC マッピングの柔軟性

実際のプロジェクトでは、CL3とBCの関係は N:M になりうる：

| パターン | 関係 | 例 | 適用場面 |
|----------|------|-----|---------|
| **CL3起点** | N CL3 → 1 BC | 複数オペレーションを1サービスに統合 | 小規模チーム |
| **BC起点** | 1 BC → N CL3 | 1サービス内に複数業務機能（デフォルト） | 標準的なケース |
| **横断型** | 1 CL3 → N BC | オペレーションが複数サービスを協調 | Saga/Process |

横断型の例（Sagaパターン）：
```
CL3: 注文処理オペレーション（BC横断）
├── BC: order-service → 注文登録
├── BC: inventory-service → 在庫引当
└── BC: payment-service → 決済処理

→ Saga/Process Manager が各BCを協調
→ 各BCは独立したマイクロサービス
```

---

## 6.3 価値から実装への一貫した分解

### 分解の全体像

パラソルの設計は「価値 → 時間 → 領域 → 能力 → 活動 → 境界 → 操作 → 画面」という一貫した軸で分解されます。

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              価値から実装への一貫した分解（完全版）                            ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃                                                                               ┃
┃   ┌─────────────────────────────────────────────────────────────────────┐    ┃
┃   │  Value Stream (VStr)                                                 │    ┃
┃   │  価値の流れ全体（大枠）                                               │    ┃
┃   │  例：「水と生きる」顧客体験の流れ                                     │    ┃
┃   └─────────────────────────────────────────────────────────────────────┘    ┃
┃                              │                                                ┃
┃                              │ 時間軸で分割                                   ┃
┃                              ▼                                                ┃
┃   ┌─────────────────────────────────────────────────────────────────────┐    ┃
┃   │  Value Stage (VS0-VS7)                                               │    ┃
┃   │  価値への時間軸（顧客状態遷移）                                       │    ┃
┃   │  例：VS0認知 → VS1興味 → VS2検討 → VS3購入 → VS4利用 → ...          │    ┃
┃   └─────────────────────────────────────────────────────────────────────┘    ┃
┃                              │                                                ┃
┃                              │ 活動領域で分類                                 ┃
┃                              ▼                                                ┃
┃   ┌─────────────────────────────────────────────────────────────────────┐    ┃
┃   │  CL1: Capability Domain（活動領域）                                  │    ┃
┃   │  Core / Supporting / Generic の分類                                  │    ┃
┃   │  例：A1基盤技術研究(Core)、S1物流(Supporting)、G1認証(Generic)       │    ┃
┃   │  【役割】投資優先度・競争優位の戦略判断                               │    ┃
┃   └─────────────────────────────────────────────────────────────────────┘    ┃
┃                              │                                                ┃
┃                              │ 領域内でケイパビリティ分離                     ┃
┃                              ▼                                                ┃
┃   ┌─────────────────────────────────────────────────────────────────────┐    ┃
┃   │  CL2: Capability（ケイパビリティ）                                   │    ┃
┃   │  チーム境界・サービス候補                                             │    ┃
┃   │  例：発酵研究、素材研究、商品提案、受注管理                           │    ┃
┃   │  【役割】チーム編成・サービス候補の特定                               │    ┃
┃   └─────────────────────────────────────────────────────────────────────┘    ┃
┃                              │                                                ┃
┃                              │ 活動単位で分解                                 ┃
┃                              ▼                                                ┃
┃   ┌─────────────────────────────────────────────────────────────────────┐    ┃
┃   │  CL3: Business Operation（ビジネスオペレーション）                   │    ┃
┃   │  業務活動（複数アクターが協調、Epic/Feature レベル）                  │    ┃
┃   │  例：見積作成オペレーション、受注処理オペレーション                   │    ┃
┃   │  【役割】アジャイルのEpic/Feature、変更単位の特定                    │    ┃
┃   │  【注意】オペレーション ≠ ユースケース                               │    ┃
┃   └─────────────────────────────────────────────────────────────────────┘    ┃
┃                              │                                                ┃
┃                              │ 活動境界でグルーピング                         ┃
┃                              ▼                                                ┃
┃   ┌─────────────────────────────────────────────────────────────────────┐    ┃
┃   │  BC: Bounded Context（活動境界）                                     │    ┃
┃   │  API・DB・変更範囲の限定                                              │    ┃
┃   │  例：受注管理BC = API群 + DBスキーマ + コード変更範囲                 │    ┃
┃   │  【役割】変更影響範囲の限定、マイクロサービス境界                     │    ┃
┃   └─────────────────────────────────────────────────────────────────────┘    ┃
┃                              │                                                ┃
┃                              │ 単一ユーザ操作に分解                           ┃
┃                              ▼                                                ┃
┃   ┌─────────────────────────────────────────────────────────────────────┐    ┃
┃   │  Actor UseCase（アクターユースケース）                               │    ┃
┃   │  単一ユーザの完結操作（User Story レベル）                            │    ┃
┃   │  例：見積書を作成する、見積承認を依頼する、注文を登録する             │    ┃
┃   │  【役割】アジャイルのUser Story、1スプリントで完了可能な単位         │    ┃
┃   └─────────────────────────────────────────────────────────────────────┘    ┃
┃                              │                                                ┃
┃                              │ UI実装に分解                                   ┃
┃                              ▼                                                ┃
┃   ┌─────────────────────────────────────────────────────────────────────┐    ┃
┃   │  View（ビュー）                                                      │    ┃
┃   │  UI画面・操作インターフェース（Task レベル）                          │    ┃
┃   │  例：見積作成画面、見積一覧画面、注文登録フォーム                     │    ┃
┃   │  【役割】アジャイルのTask、実装タスク                                │    ┃
┃   └─────────────────────────────────────────────────────────────────────┘    ┃
┃                                                                               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

### CL3（オペレーション）と Actor UseCase の違い

```
┌─────────────────────────────────────────────────────────────────────────────┐
│           CL3: Business Operation vs Actor UseCase                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  CL3: Business Operation（ビジネスオペレーション）                  │    │
│  │  ──────────────────────────────────────────────────────────────    │    │
│  │  ・複数アクターが協調する業務活動                                   │    │
│  │  ・数日〜数週間の期間                                               │    │
│  │  ・Epic/Feature レベル                                              │    │
│  │                                                                     │    │
│  │  例：「見積作成オペレーション」                                     │    │
│  │      営業 → 上長 → 顧客 が協調して見積を完成させる                  │    │
│  │                                                                     │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                              │                                              │
│                              │ 分解                                         │
│                              ▼                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  Actor UseCase（アクターユースケース）                              │    │
│  │  ──────────────────────────────────────────────────────────────    │    │
│  │  ・単一ユーザの完結操作                                             │    │
│  │  ・数分〜数時間の期間                                               │    │
│  │  ・User Story レベル                                                │    │
│  │                                                                     │    │
│  │  例：                                                               │    │
│  │  ├─「見積書を作成する」（営業）                                    │    │
│  │  ├─「見積承認を依頼する」（営業）                                  │    │
│  │  ├─「見積を承認する」（上長）                                      │    │
│  │  └─「見積を確認する」（顧客）                                      │    │
│  │                                                                     │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 分解軸サマリー（完全版）

| レベル | 分解軸 | 定義 | 境界の種類 | 技術対応 | Phase |
|--------|--------|------|-----------|---------|-------|
| **VStr** | 価値の流れ | 顧客価値の全体像 | - | - | 2 |
| **VS** | 時間 | 顧客状態遷移 | - | - | 2 |
| **CL1** | 活動領域 | Core/Supporting/Generic | 投資優先度 | Portfolio | 3 |
| **CL2** | 能力単位 | ケイパビリティ | **組織境界（チーム）** | Product/チーム | 3 |
| **CL3** | 業務活動 | ビジネスオペレーション | ロジック境界 | API群/モジュール | 3 |
| **BC** | 活動境界 | 言語・変更範囲 | **言語境界** | サービス候補※ | 4 |
| **Actor UC** | 単一操作 | ユーザの完結操作 | - | 個別API | 4-5 |
| **View** | UI画面 | 操作インターフェース | - | 画面コンポーネント | 5 |

※ BC:サービス = 1:1（理想形）、N:1（統合型）、1:N（分割型）のいずれも可

**境界の関係**:
- CL2（チーム境界）: 1チーム → N個のBCを所有可能
- BC（言語境界）: 1BC → N個のCL3（業務機能）を包含
- BC → サービス: 1:1、N:1、1:N のパターンあり（運用判断）
- CL3（ロジック境界）: BC内のAPI群・モジュール群として実装

### BCが変更範囲を限定する理由

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      BCによる変更範囲の限定                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    業務変更の発生                                                           │
│          │                                                                  │
│          ▼                                                                  │
│    ┌─────────────────┐                                                     │
│    │ どのCL3（活動）？│                                                     │
│    └─────────────────┘                                                     │
│          │                                                                  │
│          ▼                                                                  │
│    ┌─────────────────┐                                                     │
│    │ どのBC（境界）？ │                                                     │
│    └─────────────────┘                                                     │
│          │                                                                  │
│          ▼                                                                  │
│    ╔═════════════════════════════════════════════════════════════════╗     │
│    ║  BC内で変更が完結                                                ║     │
│    ╠═════════════════════════════════════════════════════════════════╣     │
│    ║                                                                  ║     │
│    ║   ┌─────────┐   ┌─────────┐   ┌─────────┐                       ║     │
│    ║   │   API   │   │   DB    │   │  Code   │                       ║     │
│    ║   │  変更   │   │ スキーマ │   │  変更   │                       ║     │
│    ║   │         │   │  変更   │   │         │                       ║     │
│    ║   └─────────┘   └─────────┘   └─────────┘                       ║     │
│    ║                                                                  ║     │
│    ║   この境界内で影響が閉じる                                       ║     │
│    ║                                                                  ║     │
│    ╚═════════════════════════════════════════════════════════════════╝     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 具体例での構造

```
VStr: 飲料事業バリューストリーム
│
└─ VS3: 販売段階
   │
   └─ CL1: A3販売【Core Domain】
      │
      └─ CL2: 受注管理 ← チーム境界
         │
         ├─ CL3: 見積作成オペレーション ← Epic（複数アクター協調）
         │  │
         │  │    ┌─────────────────────────────────────────────┐
         │  │    │ BC: order-management-bc                     │
         │  │    │ ┌─────────────────────────────────────────┐ │
         │  │    │ │                                         │ │
         │  └────┼─┼─► Actor UseCase: 見積書を作成する       │ │ ← User Story
         │       │ │      └─► View: 見積作成画面             │ │ ← Task
         │       │ │                                         │ │
         │  └────┼─┼─► Actor UseCase: 見積承認を依頼する     │ │ ← User Story
         │       │ │      └─► View: 承認依頼画面             │ │ ← Task
         │       │ │                                         │ │
         │  └────┼─┼─► Actor UseCase: 見積を承認する         │ │ ← User Story
         │       │ │      └─► View: 承認処理画面             │ │ ← Task
         │       │ │                                         │ │
         │       │ └─────────────────────────────────────────┘ │
         │       │   API群 + DBスキーマ + コード               │
         │       └─────────────────────────────────────────────┘
         │
         ├─ CL3: 受注処理オペレーション ← Epic
         │  │
         │  ├─► Actor UseCase: 注文を登録する ← User Story
         │  ├─► Actor UseCase: 在庫を引き当てる ← User Story
         │  └─► Actor UseCase: 受注確認を送信する ← User Story
         │
         └─ CL3: 出荷指示オペレーション ← Epic
            │
            ├─► Actor UseCase: 出荷指示を作成する ← User Story
            └─► Actor UseCase: 配送業者を手配する ← User Story
```

### 従来アプローチとの比較

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      アプローチの比較                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【従来：技術駆動アプローチ】                                                │
│                                                                             │
│    技術要件 ──→ サービス分割 ──→ 後から業務整合性を調整                    │
│                                                                             │
│    問題: 業務変更がサービス横断になりがち                                    │
│          変更影響範囲が予測困難                                              │
│                                                                             │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│  【パラソル：価値駆動アプローチ】                                            │
│                                                                             │
│    価値 ──→ 時間 ──→ 領域 ──→ 能力 ──→ 活動 ──→ 境界 ──→ 操作 ──→ 画面  │
│                                                                             │
│    効果: 業務変更がBC内で完結しやすい                                        │
│          変更影響範囲 = BC範囲（予測可能）                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 重要な原則

**BC範囲 = 変更の影響範囲**

価値から一貫して分解することで、「ある業務活動を変更したい」→「そのCL3が属するBC内で変更が閉じる」という設計が実現します。

**CL3 ≠ UseCase**
- CL3（オペレーション）: 複数アクター協調 → Epic/Feature
- Actor UseCase: 単一ユーザ操作 → User Story

---

## 7. クイックリファレンス

### コマンド一覧

```bash
# プロジェクト管理
/parasol:0-project init {name}    # 新規作成
/parasol:0-project list           # 一覧
/parasol:0-status                 # 進捗確認

# Phase 1-2: ビジネス層
/parasol:1-context                # Context定義
/parasol:2-value                  # Value Stream定義

# Phase 3: サービス層（Capability）
/parasol:3-capabilities cl1       # CL1: 活動領域分類
/parasol:3-capabilities cl2 VS2   # CL2: Capability設計
/parasol:3-capabilities cl3 {cap} # CL3: Operation定義（ビジネスUC）
/parasol:3-capabilities bc {cap}  # BC: 実装設計開始

# Phase 4-7: 実装層
/parasol:4-architecture           # Application設計
/parasol:5-software {svc} {bc}    # Software設計
/parasol:6-implementation {svc}   # 実装
/parasol:7-platform               # Platform設計
```

### 重要な境界線

```
┌─────────────────────────────────────────────────────────────┐
│  Phase 1-3: 設計フェーズ（変更容易）                         │
│                                                             │
│  ・ビジネス要件の理解と整理                                  │
│  ・サービス候補の特定                                        │
│  ・ビジネスUCの定義                                         │
└─────────────────────────────────────────────────────────────┘
                          ↓
━━━━━━━━━━━━━━━━━━━━ Phase 4 = サービス枠確定 ━━━━━━━━━━━━━━━━━━━
                          ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 4-7: 実装フェーズ（枠内で作業）                       │
│                                                             │
│  ・サービス境界は確定済み                                    │
│  ・実装UCの詳細化                                           │
│  ・コード実装                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 参照

- `/parasol:0-help` - ヘルプシステム
- `_zigzag-process.md` - ZIGZAGプロセス詳細
- `_value-methodology.md` - 価値方法論
- `_parasol-architecture-overview.md` - 3層アーキテクチャ

---

**作成日**: 2025-12-09
**更新日**: 2025-12-10
**バージョン**: V5.7（価値→実装の完全分解構造）
