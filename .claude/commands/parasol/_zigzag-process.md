# Parasol V5 - 価値駆動ZIGZAGプロセス

## 概要

Parasol V5は、価値からソフトウェア実装まで、3層のネストしたWHAT→HOWパターン（ZIGZAGプロセス）で体系的に分解します。

```
価値（WHAT）→ 実現方法（HOW）→ 必要能力（WHAT）→ 実装（HOW）
```

---

## ZIGZAGの本質

### 核心的定義

```
┌─────────────────────────────────────────────────────────────────────┐
│ ZIGZAG = 視座転換による創発的分解                                    │
│                                                                     │
│ WHATの抽象語彙空間で行き詰まった時、                                 │
│ HOWの具体語彙空間への強制転換により、                                │
│ 元のWHATに暗黙に含まれていた未言語化概念が顕在化する。               │
│                                                                     │
│ これは「分解」ではなく「創発」であり、                               │
│ 入力より豊かな出力が生まれるメカニズムである。                       │
└─────────────────────────────────────────────────────────────────────┘
```

### なぜWHATは分解できなくなるのか

WHATが分解できなくなるのは「語彙の欠如」による。これは問題空間の解像度不足であり、抽象概念を構成する要素が見えていない状態。

```
例: 「認証機能」（WHAT）
  ↓ これ以上分解しようとしても...
  「認証を...する...機能？」（行き詰まり）
```

**行き詰まりの正体**: 同一抽象レベルでの思考の飽和。同じ語彙空間をぐるぐる回っている状態。

### HOWがWHATの分解を可能にするメカニズム

HOWを考えることで強制的に**異なる語彙空間**へ移動する。

```
WHAT: 「認証機能」（抽象語彙空間）
  ↓ 「どう実装する？」と問う（視点転換）
HOW:  「OAuth」「JWT発行」「セッション管理」（具体語彙空間）
  ↓ 各HOWから新しいWHATが見える
WHAT': 「トークン管理」「リフレッシュ戦略」「失効処理」
       ↑
       入力には含まれていなかった概念が出現（創発）
```

**重要な洞察**: これは「分解」ではなく「創発」。HOWを考えることで、元のWHATが暗黙に前提していた未言語化要件が顕在化する。

### 他分野での類似パターン

| 分野 | パターン | ZIGZAGとの対応 |
|------|----------|---------------|
| **認知科学** | 図と地の反転（Gestalt） | WHAT（図）が見えなくなったらHOW（地）に転換 |
| **量子力学** | 相補性原理（ボーア） | WHATとHOWは相補的な観測モード |
| **言語学** | 深層/表層構造（チョムスキー） | 表層（HOW）を操作して深層（WHAT）を発見 |
| **哲学** | 弁証法 | テーゼ(WHAT)→アンチテーゼ(HOW)→ジンテーゼ(WHAT') |

### 従来手法との違い

| 手法 | 進行パターン | 限界 |
|------|-------------|------|
| トップダウン | WHAT→WHAT→WHAT | 抽象度の壁で停止 |
| ボトムアップ | HOW→HOW→HOW | 全体像を見失う |
| **ZIGZAG** | WHAT↔HOW交互 | 壁を迂回して進む |

### なぜ3層か

3層は「認識の最小完結単位」：

- **2層**: 対立のみ（WHAT vs HOW）→ 緊張は生まれるが解決しない
- **3層**: 対立 + 止揚（WHAT'の創発）→ 弁証法的完結
- **4層以上**: 3層の入れ子として還元可能

---

## 保存すべき緊張（未解決の問い）

ZIGZAGには以下の未解決の問いがあり、これらは安易に解消せず設計判断時に意識的に参照すべき：

### 1. 「分解できない」の多義性

| 解釈 | 意味 | 対処 |
|------|------|------|
| **存在論的限界** | 本質的に分割不可能な原子単位 | HOWで確認 |
| **認識論的限界** | 現時点の知識/文脈で見えない | HOWで顕在化 |

→ どちらの場合もHOWへの移行が有効なら、実践的には区別不要かもしれない

### 2. 分解の「正しさ」の基準

- 後のHOWが容易になること？
- 実装可能性？
- 美的一貫性？
- → **事後的にしか判断できない可能性**

### 3. ZIGZAGは必然か選択肢か

- トップダウンのみでも成功する場合がある
- 文脈依存の戦略であり、普遍法則ではない可能性
- → **適用判断が必要**

---

## 実践ガイド：「詰まり」の検知と突破

### 詰まりの検知シグナル

以下が発生したら、WHATでの思考が飽和している：

1. **同じ単語が3回以上繰り返される**
   - 「顧客管理...顧客を管理...管理する顧客...」

2. **「つまり」で言い換えても新情報がない**
   - 「認証機能、つまりユーザーを認証する機能」

3. **抽象度が変わらない**
   - 上にも下にも行けない膠着状態

### 突破方法：強制的HOW転換

```
詰まり検知
  ↓
「これをどう実装/実現するか？」と強制的に問う
  ↓
具体的な手段・技術・活動を列挙
  ↓
各HOWから見えてくる新しいWHATを言語化
  ↓
新しいWHAT（WHAT'）を記録して次へ
```

### Phase間ハンドオフでの活用

```
前Phase出力（WHAT）
    ↓ 次Phaseで「どう？」を問う
次Phase（HOW視点で見る）
    ↓ 発見された新WHAT'を
次Phase出力に明示的に追加
```

---

## 3層ZIGZAGモデル

```
┌─────────────────────────────────────────────────────────────────────┐
│  Level 1: ビジネス層                                                │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│    WHAT              →              HOW                             │
│    価値                          Value Stream                       │
│   「何を実現したいか」           「どう流れるか」                    │
│                                                                     │
│   Phase 2 前半                   Phase 2 後半                       │
└─────────────────────────────────────────────────────────────────────┘
                                     ↓
┌─────────────────────────────────────────────────────────────────────┐
│  Level 2: サービス層                                                │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│    WHAT              →              HOW                             │
│  Capability                      Service設計                        │
│  「何が必要か」                  「どう分割するか」                  │
│                                                                     │
│   Phase 3                        Phase 4                            │
└─────────────────────────────────────────────────────────────────────┘
                                     ↓
┌─────────────────────────────────────────────────────────────────────┐
│  Level 3: 実装層                                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│    WHAT              →              HOW                             │
│  Software設計                      実装                             │
│  「何を作るか」                  「どう作るか」                      │
│                                                                     │
│   Phase 5                        Phase 6                            │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Phaseとの対応

| Phase | Level | WHAT/HOW | 内容 | 主要成果物 |
|-------|-------|----------|------|-----------|
| **1** | - | 前提 | Context（組織・市場・制約） | organization-analysis.md |
| **2a** | **L1** | **WHAT** | **価値定義** | value-definition.md |
| **2b** | **L1** | **HOW** | **Value Stream/Stage** | value-streams-mapping.md |
| **3** | **L2** | **WHAT** | **Capability（サービス候補）** | capabilities.md |
| **4** | **L2** | **HOW** | **Service設計（境界・Context Map）** | service-boundaries.md |
| **5** | **L3** | **WHAT** | **Software設計** | domain-model.md, api-specs/ |
| **6** | **L3** | **HOW** | **実装** | コード |
| **7** | - | 基盤 | Platform（インフラ・運用） | infrastructure.md |

---

## 各レベルの詳細

### Level 1: ビジネス層（Phase 2）

**目的**: ビジネス価値とその実現の流れを定義

#### WHAT: 価値定義（Phase 2前半）

- 企業が提供する価値は何か
- ステークホルダーにとっての価値
- 価値指標（KPI）

```
質問: 「このビジネスは何を実現するのか？」
出力: value-definition.md
```

#### HOW: Value Stream（Phase 2後半）

- 価値を実現する活動の流れ
- Value Stream → Value Stage への分解
- Stage間の依存関係

```
質問: 「価値はどのように流れるのか？」
出力: value-streams-mapping.md, vs{N}-detail.md
```

---

### Level 2: サービス層（Phase 3-4）

**目的**: Value Stageをスイムレーンとしてサービス境界を確定

#### WHAT: Capability（Phase 3）

- 各Value Stageに必要なケイパビリティ
- サービス候補の特定
- 重複のない唯一無二のサービス単位

```
質問: 「各Stageで何ができる必要があるか？」
出力: capabilities.md

┌──────────┐  ┌──────────┐  ┌──────────┐
│ Stage 1  │  │ Stage 2  │  │ Stage 3  │  ← スイムレーン
├──────────┤  ├──────────┤  ├──────────┤
│ Cap A    │  │ Cap D    │  │ Cap G    │  ← Capability
│ Cap B    │  │ Cap E    │  │ Cap H    │    （サービス候補）
│ Cap C    │  │ Cap F    │  │ Cap I    │
└──────────┘  └──────────┘  └──────────┘
```

#### HOW: Service設計（Phase 4）

- サービス境界の確定
- Context Map（サービス間関係）
- API契約の概要

```
質問: 「サービスをどう分割・連携させるか？」
出力: service-boundaries.md, context-map.md

※ここで「サービス枠」をフリーズ
※以降の変更は高コスト
```

---

### Level 3: 実装層（Phase 5-6）

**目的**: 確定したサービス枠内で設計・実装

#### WHAT: Software設計（Phase 5）

- ドメインモデル
- API仕様
- データベース設計
- ユースケース詳細

```
質問: 「各サービスで何を作るか？」
出力: domain-model.md, api-specs/, database-design.md
```

#### HOW: 実装（Phase 6）

- コード生成
- テスト
- リファクタリング

```
質問: 「どう作るか？」
出力: src/, tests/
```

---

## Value Stage Swimlane パターン

### なぜスイムレーンか

| 観点 | スイムレーン方式 | ボトムアップ方式 |
|------|-----------------|-----------------|
| **サービス境界** | Value Stageで事前確定 | 後から決めるため曖昧に |
| **重複リスク** | 低い（境界が明確） | 高い（ユーザー視点で重複） |
| **修正コスト** | 低い（事前設計） | 高い（結合後の分離困難） |

### スイムレーンの作り方

```
Step 1: Value Streamを特定
        「調達 → 製造 → 販売」

Step 2: 各Stageをスイムレーンとして配置
        ┌────────┐ ┌────────┐ ┌────────┐
        │ 調達   │ │ 製造   │ │ 販売   │
        └────────┘ └────────┘ └────────┘

Step 3: 各スイムレーン内でCapabilityを列挙
        ┌────────┐ ┌────────┐ ┌────────┐
        │原料調達│ │製品開発│ │受注管理│
        │品質検査│ │生産管理│ │出荷管理│
        │在庫管理│ │品質保証│ │顧客管理│
        └────────┘ └────────┘ └────────┘

Step 4: 各Capabilityがサービス候補
        → Phase 4で境界を確定
```

---

## ハイレベルユースケースの位置づけ

### どこで使うか

ハイレベルユースケースは**Level 2（サービス層）のCapability内部**で活用：

```
Capability（サービス候補）
    │
    ├── ハイレベルUC 1: 「顧客が見積もりを依頼する」
    ├── ハイレベルUC 2: 「営業が見積もりを作成する」
    └── ハイレベルUC 3: 「顧客が見積もりを承認する」
```

### なぜこの位置か

- **境界は既に確定**: Value Stageスイムレーンで重複なし
- **中身の充填に最適**: 具体的なシナリオで業務理解を深める
- **ビジネスユーザーが語りやすい**: 抽象的なCapabilityより具体的

---

## DDD用語との対応（技術者向け参照）

| Parasol用語 | DDD用語 | 備考 |
|-------------|---------|------|
| Value Stage | Domain | 戦略的分類を含む |
| Capability | Subdomain | サービス候補 |
| ハイレベルUC | Use Case | 業務オペレーション |
| Service境界 | Bounded Context | Phase 4で確定 |

---

## コマンド体系

```bash
# Level 1: ビジネス層
/parasol:2-value                    # WHAT: 価値定義
/parasol:2-value VS1                # HOW: Value Stream詳細

# Level 2: サービス層
/parasol:3-capabilities             # WHAT: Capability一覧
/parasol:3-capabilities VS1         # 特定VSのCapability
/parasol:4-architecture             # HOW: Service設計

# Level 3: 実装層
/parasol:5-software [service]       # WHAT: Software設計
/parasol:6-implementation [service] # HOW: 実装
```

---

## 重要な原則

### 1. Phase 4でサービス枠をフリーズ

```
Phase 1-4: 設計フェーズ（変更容易）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
           ↓ Phase 4完了 = サービス枠確定
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Phase 5-6: 実装フェーズ（枠内で作業）
```

### 2. 各レベルでWHAT→HOWを完了してから次へ

```
✓ L1: 価値が明確 → Value Streamが定義できる
✓ L2: Capabilityが明確 → Service境界が決まる
✓ L3: 設計が明確 → 実装できる
```

### 3. 上位レベルの決定は下位に影響

```
価値変更 → 全レベルに影響（大）
Capability変更 → L2-L3に影響（中）
設計変更 → L3のみ影響（小）
```

---

## 参照

- `/parasol:0-help concepts` - 主要概念の説明
- `/parasol:0-help workflow` - 実行ワークフロー
- `parasol-v5/FRAMEWORK-DESIGN.md` - 詳細設計ドキュメント
