# Chapter 19 設計書: 非機能要件

## 基本情報
- **パート**: Part 5 - Solution Space (Architecture)
- **位置**: 第19章 / 全38章
- **想定執筆時間**: 4時間
- **現在の状態**: 未着手
- **コード比率**: 現在0% → 目標30%

## 章の位置づけ

### 前章からの継続
- **Chapter 18**: 境界づけられたコンテキスト
- **引き継ぐ概念**: 分散システムにおける境界間通信の品質課題
- **前提となる理解**: システム境界、コンテキストマップ、通信パターン

### 本章の役割
- **主要学習目標**: 非機能要件の体系的な定義と実現方法
- **解決する問題**: 「速い」「安定」などの曖昧な要求の具体化
- **導入する概念**: SLI/SLO/SLA、品質シナリオ、トレードオフマトリクス

### 次章への準備
- **Chapter 20**: ドメインモデリング（Software Designセクション開始）
- **橋渡しする要素**: 非機能要件を満たすドメインモデルの設計
- **準備する概念**: 性能とモデル純粋性のバランス

## 読者層別価値提供

### エグゼクティブ向け価値
- **ビジネスケース**: Amazon Prime Dayの99.99%可用性が売上に直結
- **ROI/リスク情報**: 1%の性能改善 = 売上2%向上の相関（Amazon事例）
- **意思決定ポイント**: コストと品質のトレードオフ、SLA違反のビジネス影響
- **読了時間**: 5分

### アーキテクト向け価値
- **設計原則**: 品質属性の優先順位付けフレームワーク
- **パターンと選択**: 12の品質属性と実現パターンマトリクス
- **トレードオフ分析**: 性能 vs 可用性 vs セキュリティの三角形
- **読了時間**: 40分

### 開発者向け価値
- **実装ガイド**: 監視・計測の実装方法
- **ツールと手法**: Prometheus、Grafana、分散トレーシング
- **コード例の場所**: Appendix 19.1-19.3
- **読了時間**: 20分

## 詳細構成

### Section 1: フック (600語)
**ストーリー候補**: Slackの2021年正月大障害と透明性の教訓
**選定理由**: 
- 非機能要件の重要性が全世界に露呈
- 障害対応の透明性が信頼を生んだ稀有な例
- SLOベースの改善アプローチの成功

**導入する緊張感**: 
「2021年1月4日午前6時、世界中の企業が仕事始めを迎えた瞬間、Slackが完全停止。しかし、この4時間の障害が、業界最高の信頼性文化を生み出すきっかけとなった...」

### Section 2: 問題の本質 (500語)
**抽象化する課題**: 非機能要件は「見えない契約」
**3層の関心事**:
- ビジネス課題: ユーザー期待値と提供品質のギャップ
- アーキテクチャ課題: 相反する品質要求の調整
- 実装課題: 測定不可能な要求の具体化

### Section 3: 核心概念 (1200語)
**中心となる理論/フレームワーク**: Google SREのSLI/SLO/SLAピラミッド
**導入順序**:
1. 品質属性の分類体系（ISO 25010ベース、実用的に簡略化）
2. 品質シナリオによる要求の具体化手法
3. トレードオフ分析と優先順位付け
4. エラーバジェットの概念と活用

**ビジュアル表現**: 
- 図19-1: 12の品質属性と相互影響マップ
- 図19-2: SLI→SLO→SLAのピラミッド構造とSlackの実例

### Section 4: 実世界例 (700語)
**選定した例**: 決済システムの非機能要件実装
**段階的展開**:
1. 初期状態: 「高速で安定した決済」という曖昧な要求
2. 課題認識: 障害時の損失が1分100万円と判明
3. 解決適用: 品質シナリオ作成→SLO定義→アーキテクチャ最適化
4. 結果評価: 可用性99.95%達成、応答時間p99で200ms以下

**コードブロック計画**:
- Block 1 (10行): SLI定義のPrometheusクエリ例
- Block 2 (12行): サーキットブレーカーの実装パターン
- Block 3 (8行): 品質シナリオのYAML定義

### Section 5: 実践ガイダンス (400語)
**適用タイミング**: 
- アーキテクチャ決定前（要求確定時）
- 本番運用開始前（SLO設定時）
- インシデント後（改善時）

**成功条件**: 
- 測定可能なメトリクスの定義
- ステークホルダー合意
- 継続的な監視体制

**よくある失敗**: 
- 全ての品質を最高にしようとする
- 測定せずに改善を試みる
- ビジネス影響を考慮しない技術SLO

**チェックリスト**: 
- [ ] 重要な品質属性を3つ以下に絞ったか
- [ ] 各属性に測定可能なSLIを定義したか
- [ ] エラーバジェットを計算したか
- [ ] 監視ダッシュボードを構築したか

### Section 6: 技術統合 (300語)
**既存手法との関係**:
- Agile/Scrum: スプリントごとの品質メトリクス追跡
- マイクロサービス: サービスメッシュでの品質保証
- DDD: アグリゲート設計への性能要件の反映

**次章への流れ**: 
「アーキテクチャと非機能要件が定まった今、次はビジネスロジックをどうモデル化するか。Chapter 20では、DDDの戦術的設計パターンを使った...」

## 付録配置計画

### Appendix 19.1: 品質属性カタログと測定方法
- 移動対象: 12属性の詳細定義と測定手法
- 想定行数: 400行
- 参照方法: 「各属性の詳細はAppendix 19.1参照」

### Appendix 19.2: 監視システム構築ガイド
- 移動対象: Prometheus + Grafana + Jaegerの設定
- フォーマット: docker-compose.yml + 設定ファイル
- 使用説明: ステップバイステップの構築手順

### Appendix 19.3: SLOテンプレート集
- 対象ツール: 各種システム向けSLOテンプレート
- セットアップ手順: カスタマイズ方法と計算式
- トラブルシュート: よくあるSLO違反パターンと対策

## 品質チェックリスト

### 執筆前確認
- [x] 前章の内容を正確に引き継いでいるか
- [x] 3読者層の価値が明確か
- [x] ストーリーは魅力的か
- [x] コード配分計画は30%以下か

### 執筆後確認
- [ ] 70:30比率達成
- [ ] 6セクション構成準拠
- [ ] 用語統一（スタイルガイド準拠）
- [ ] 前後章との整合性
- [ ] 図表の効果的使用

## リスクと対策

| リスク項目 | 影響度 | 対策 |
|-----------|--------|------|
| 技術的になりすぎる | 高 | ビジネス影響を常に強調、Slack事例で人間味を |
| 抽象的すぎる | 中 | 具体的な数値例、実装コードを適度に含める |
| ツール依存 | 低 | 原理原則を中心に、ツールは付録で |

## メモ・特記事項

- Google SRE本の概念を参照しつつ、エンタープライズ文脈に翻訳
- Slackの障害報告書は公開情報として利用可能
- 「完璧よりも透明性」というメッセージを込める
- クラウドネイティブ時代の品質保証手法を強調
- Part 5 Architectureセクションの締めくくりとして、次のSoftware Designへ自然に接続

---

設計者: parasol-book-architect
設計日: 2025-12-28
最終更新: 2025-12-28