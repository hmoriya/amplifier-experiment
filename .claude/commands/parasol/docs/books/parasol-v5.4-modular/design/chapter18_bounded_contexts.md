# Chapter 18 設計書: 境界づけられたコンテキスト

## 基本情報
- **パート**: Part 5 - Solution Space (Architecture)
- **位置**: 第18章 / 全38章
- **想定執筆時間**: 4時間
- **現在の状態**: 未着手
- **コード比率**: 現在0% → 目標20%

## 章の位置づけ

### 前章からの継続
- **Chapter 17**: アーキテクチャパターン
- **引き継ぐ概念**: 選択されたアーキテクチャパターン内での境界設計
- **前提となる理解**: パターン選択基準、トレードオフ分析

### 本章の役割
- **主要学習目標**: ドメイン駆動設計による適切な境界の発見と定義
- **解決する問題**: システム分割の恣意性と境界の曖昧さ
- **導入する概念**: コンテキストマップ、ユビキタス言語、境界の進化

### 次章への準備
- **Chapter 19**: 非機能要件
- **橋渡しする要素**: 境界設計が非機能要件に与える影響
- **準備する概念**: 境界をまたぐ通信の品質特性

## 読者層別価値提供

### エグゼクティブ向け価値
- **ビジネスケース**: Amazonの「2 pizza team」ルールとサービス境界の一致
- **ROI/リスク情報**: 適切な境界設計による開発速度2-3倍向上
- **意思決定ポイント**: チーム編成とシステム境界の整合性確保
- **読了時間**: 5分

### アーキテクト向け価値
- **設計原則**: 言語境界、組織境界、技術境界の3層モデル
- **パターンと選択**: 9つのコンテキスト関係パターン
- **トレードオフ分析**: 独立性 vs 一貫性 vs 複雑性
- **読了時間**: 40分

### 開発者向け価値
- **実装ガイド**: 境界間通信の実装パターン
- **ツールと手法**: EventStorming、Context Mapping
- **コード例の場所**: Appendix 18.1-18.3
- **読了時間**: 20分

## 詳細構成

### Section 1: フック (700語)
**ストーリー候補**: Uberの初期アーキテクチャ崩壊と再設計
**選定理由**: 
- 急成長による境界設計の失敗が明確
- グローバル展開での言語/文化の境界問題
- マイクロサービス分割の教訓

**導入する緊張感**: 
「2014年、Uberのエンジニアは恐怖に震えていた。1つのバグ修正が、地球の裏側の決済システムを停止させる。1000以上のマイクロサービスが、境界なき迷宮と化していた...」

### Section 2: 問題の本質 (400語)
**抽象化する課題**: 境界は発見するもの、作るものではない
**3層の関心事**:
- ビジネス課題: ビジネスケイパビリティと技術境界の不一致
- アーキテクチャ課題: 過度の分割による複雑性爆発
- 実装課題: 分散トランザクションとデータ整合性

### Section 3: 核心概念 (1100語)
**中心となる理論/フレームワーク**: DDDの境界づけられたコンテキスト
**導入順序**:
1. ユビキタス言語の重要性（同じ言葉が異なる意味を持つ）
2. コンテキストマップの作成（関係性の可視化）
3. 境界の進化パターン（分割、統合、移動）

**ビジュアル表現**: 
- 図18-1: Uber再設計前後のコンテキストマップ
- 図18-2: 境界進化の5つのパターン（分割、統合、抽出、吸収、変換）

### Section 4: 実世界例 (900語)
**選定した例**: ECサイトの在庫管理システム再設計
**段階的展開**:
1. 初期状態: 「商品」という言葉が7つの異なる意味で使用
2. 課題認識: 在庫数の不整合、二重販売の頻発
3. 解決適用: EventStormingによる境界の再発見
4. 結果評価: 4つの明確なコンテキストに分離、不整合99%削減

**コードブロック計画**:
- Block 1 (6行): コンテキスト間の契約定義（API仕様）
- Block 2 (8行): アンチコラプションレイヤーの実装例
- Block 3 (5行): イベントによる境界間通信

### Section 5: 実践ガイダンス (500語)
**適用タイミング**: 
- 言葉の意味が曖昧になったとき
- チーム間の調整が増大したとき
- データモデルが複雑化したとき

**成功条件**: 
- 各コンテキストに明確なオーナーチーム
- ユビキタス言語の文書化
- 境界をまたぐ契約の明示

**よくある失敗**: 
- 技術的な理由での境界設定
- 過度に細かい分割
- 既存組織に合わせた恣意的境界

**チェックリスト**: 
- [ ] EventStormingを実施したか
- [ ] 各コンテキストの言語を定義したか
- [ ] チーム境界と一致しているか
- [ ] 将来の変更に対応できるか

### Section 6: 技術統合 (400語)
**既存手法との関係**:
- Agile/Scrum: フィーチャーチームとコンテキストの整合
- マイクロサービス: 1コンテキスト≠1サービス（粒度の違い）
- DDD: 戦略的設計と戦術的設計の接続点

**次章への流れ**: 
「境界が定まれば、次はその境界をまたぐ通信の品質をどう保証するか。Chapter 19では、分散システムにおける非機能要件の実現方法を...」

## 付録配置計画

### Appendix 18.1: EventStormingワークショップガイド
- 移動対象: ファシリテーション手順と成果物例
- 想定行数: 200行
- 参照方法: 「実施方法の詳細はAppendix 18.1参照」

### Appendix 18.2: コンテキストマップパターンカタログ
- 移動対象: 9つの関係パターンの詳細と実装例
- フォーマット: 図解とコード例の組み合わせ
- 使用説明: 各パターンの適用条件と実装方法

### Appendix 18.3: 境界リファクタリング手法
- 対象ツール: 段階的境界変更のテクニック
- セットアップ手順: Branch by Abstraction、Parallel Run
- トラブルシュート: データ移行、トランザクション管理

## 品質チェックリスト

### 執筆前確認
- [x] 前章の内容を正確に引き継いでいるか
- [x] 3読者層の価値が明確か
- [x] ストーリーは魅力的か
- [x] コード配分計画は30%以下か

### 執筆後確認
- [ ] 70:30比率達成
- [ ] 6セクション構成準拠
- [ ] 用語統一（スタイルガイド準拠）
- [ ] 前後章との整合性
- [ ] 図表の効果的使用

## リスクと対策

| リスク項目 | 影響度 | 対策 |
|-----------|--------|------|
| DDD用語の難解さ | 高 | 平易な言葉での説明を優先、専門用語は段階導入 |
| 抽象概念の理解困難 | 中 | ECサイトの具体例で一貫して説明 |
| 実装との乖離 | 中 | 実際のコード例を最小限含める |

## メモ・特記事項

- Eric Evans原著の概念を尊重しつつ、現代的な解釈を加える
- Uberの事例は公開されたエンジニアリングブログベース
- 「境界は発見するもの」という哲学を強調
- モジュラーモノリスへの適用可能性も言及
- Team Topologiesとの関連性も簡潔に触れる

---

設計者: parasol-book-architect
設計日: 2025-12-28
最終更新: 2025-12-28