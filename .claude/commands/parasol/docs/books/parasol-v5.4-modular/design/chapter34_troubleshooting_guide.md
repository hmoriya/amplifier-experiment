# Chapter 34 設計書: トラブルシューティングガイド

## 基本情報
- **パート**: Part 7 - Practice
- **位置**: 第34章 / 全38章
- **想定執筆時間**: 5時間
- **現在の状態**: 未着手
- **コード比率**: 目標15% （診断フローと概念中心）

## 章の位置づけ

### 前章からの継続
- **Chapter 33**: パフォーマンスチューニング実践
- **引き継ぐ概念**: 体系的な問題分析アプローチ
- **前提となる理解**: 層別分析の有効性

### 本章の役割
- **主要学習目標**: ZIGZAG構造での問題診断と解決
- **解決する問題**: 「問題の根本原因をどう特定するか」
- **導入する概念**: 層間トレーサビリティ、根本原因分析

### 次章への準備
- **Chapter 35**: ベストプラクティス集
- **橋渡しする要素**: 問題解決から予防へのシフト
- **準備する概念**: プロアクティブな品質管理

## 読者層別価値提供

### エグゼクティブ向け価値
- **ビジネスケース**: 障害対応時間80%削減の実例
- **ROI/リスク情報**: 体系的診断によるMTTR短縮
- **意思決定ポイント**: インシデント管理への投資判断
- **読了時間**: 5分

### アーキテクト向け価値
- **設計原則**: 可観測性設計、診断可能性の組み込み
- **パターンと選択**: ログ戦略、トレース設計、メトリクス選定
- **トレードオフ分析**: 診断性vs性能vsコスト
- **読了時間**: 40分

### 開発者向け価値
- **実装ガイド**: デバッグ手法、ログ分析テクニック
- **ツールと手法**: 層別診断ツールキット
- **コード例の場所**: 付録34.1-34.3
- **読了時間**: 20分

## 詳細構成

### Section 1: フック (500-800語)
**ストーリー候補**: メルカリの大規模障害からの復旧劇
**選定理由**: 複雑な分散システムでの診断の困難さを示す
**導入する緊張感**: 「サービス停止30分で億単位の損失」

### Section 2: 問題の本質 (300-500語)
**抽象化する課題**: 複雑システムでの因果関係特定
**3層の関心事**:
- ビジネス課題: ダウンタイムの最小化、影響範囲の特定
- アーキテクチャ課題: 依存関係の追跡、障害の伝播
- 実装課題: ログとトレースの相関

### Section 3: 核心概念 (800-1200語)
**中心となる理論/フレームワーク**: ZIGZAG診断フレームワーク
**導入順序**:
1. 症状から層の特定（どの層で問題が顕在化？）
2. 層内での原因追跡（同一層での水平分析）
3. 層間での根本原因探索（垂直トレース）

**ビジュアル表現**: 
- 図34-1: 層別問題診断フローチャート
- 図34-2: インシデント対応の実例タイムライン

### Section 4: 実世界例 (600-1000語)
**選定した例**: 決済システムでの障害診断
**段階的展開**:
1. 症状：決済完了率の急激な低下
2. ビジネス層分析：特定の決済方法のみ影響
3. サービス層分析：外部APIタイムアウト発見
4. 実装層分析：接続プール枯渇が根本原因

**コードブロック計画**:
- Block 1 (5行): 診断スクリプトの例
- Block 2 (8行): ログ相関クエリ
- Block 3 (7行): アラート設定例

### Section 5: 実践ガイダンス (400-600語)
**適用タイミング**: インシデントレベル別対応フロー
**成功条件**: 明確な役割分担、ツール整備、訓練された対応
**よくある失敗**: 推測での対処、部分情報での判断
**チェックリスト**: インシデント対応準備度

### Section 6: 技術統合 (300-500語)
**既存手法との関係**:
- SRE: エラーバジェットとの統合
- Chaos Engineering: 予防的診断
- AIOps: 機械学習による異常検知

**次章への流れ**: 「事後対応から予防へ：ベストプラクティス」

## 付録配置計画

### Appendix 34.1: 診断ツールキット
- 移動対象: 各層での診断コマンド集
- 想定行数: 200行
- 参照方法: 「具体的なコマンドは付録34.1参照」

### Appendix 34.2: インシデント対応プレイブック
- 移動対象: テンプレートとチェックリスト
- フォーマット: Markdown形式
- 使用説明: カスタマイズガイド付き

### Appendix 34.3: ポストモーテムテンプレート
- 対象ツール: 障害分析フォーマット
- セットアップ手順: 組織への導入方法
- トラブルシュート: よくある分析の罠

## 品質チェックリスト

### 執筆前確認
- [ ] 前章の内容を正確に引き継いでいるか
- [ ] 3読者層の価値が明確か
- [ ] ストーリーは魅力的か
- [ ] コード配分計画は15%以下か

### 執筆後確認
- [ ] 85:15比率達成
- [ ] 6セクション構成準拠
- [ ] 用語統一（スタイルガイド準拠）
- [ ] 前後章との整合性
- [ ] 図表の効果的使用

## リスクと対策

| リスク項目 | 影響度 | 対策 |
|-----------|--------|------|
| 一般論への陥り | 高 | 具体的な実例を中心に構成 |
| ツール依存の説明 | 中 | 原理原則ベースで説明 |
| 後ろ向きな印象 | 中 | 学習と改善の側面を強調 |

## メモ・特記事項

- 「5 Whys」などの既知手法をZIGZAG文脈で再解釈
- 心理的安全性の重要性（blame-freeな文化）に言及
- 実際のポストモーテムから学んだ教訓を含める
- 診断の「アート」と「サイエンス」のバランス
- Chapter 28（モニタリング）との連携：監視から診断へ

---

設計者: Parasol Book Architect
設計日: 2025-12-28
最終更新: 2025-12-28