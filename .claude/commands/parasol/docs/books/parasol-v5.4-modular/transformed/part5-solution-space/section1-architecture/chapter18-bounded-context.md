# 第18章　境界づけられたコンテキスト ― 国境が守る豊かな文化

## はじめに：なぜ国境は存在するのか

ヨーロッパを旅すると、国境を越えるたびに言語が変わり、通貨が変わり、文化が変わることに気づきます。フランスでは「pain」と呼ばれるパンが、ドイツでは「Brot」になり、イタリアでは「pane」になる。同じ「パン」でも、バゲット、プレッツェル、チャバッタと、その形も味も文化によって異なります。

この多様性は、国境という「境界」があるからこそ保たれています。もし境界がなければ、すべてが均一化され、豊かな文化の違いは失われてしまうでしょう。

ソフトウェアの世界も同じです。「Customer」という言葉が、営業部門では「見込み客」を意味し、サポート部門では「既存顧客」を意味し、マーケティング部門では「ターゲット層」を意味する。これらの異なる解釈を無理に統一しようとすると、各部門の業務に支障をきたします。境界づけられたコンテキストは、この多様性を保ちながら、必要な時には協力できる仕組みを提供するのです。

## 国家としてのコンテキスト

### 主権国家の要素

独立国家が持つ要素を、境界づけられたコンテキストに当てはめてみましょう：

**1. 明確な領土（境界）**
- 地理的な境界線 → コードベースの境界
- 領空・領海 → データの所有権
- 国境検問所 → API・インターフェース

**2. 独自の言語（ユビキタス言語）**
- 公用語 → ドメイン固有の用語体系
- 方言・地域語 → チーム内の専門用語
- 翻訳の必要性 → 用語の変換層

**3. 統治機構（チームと責任）**
- 政府 → 開発チーム
- 法律 → ビジネスルール
- 行政サービス → ドメインサービス

**4. 経済システム（データと処理）**
- 通貨 → データモデル
- 産業 → ビジネスロジック
- 貿易 → 他コンテキストとの連携

## 言語の境界を見つける

### 通訳が必要な瞬間

国境を見つける最も確実な方法は、「通訳が必要になる瞬間」を探すことです。

**ケーススタディ：「商品」という言葉の旅**

```
在庫管理国：「商品」= SKU（在庫管理単位）
- バリエーション（色、サイズ）ごとに別商品
- 在庫数、保管場所が重要
- 「商品コード: BLK-XL-001」（黒・XLサイズ）

販売国：「商品」= 販売アイテム
- バリエーションは選択肢の一つ
- 価格、商品説明が重要
- 「Tシャツ（色とサイズが選べます）」

物流国：「商品」= 配送物
- 重量、体積が重要
- 中身より梱包サイズが関心事
- 「小包１個（500g）」
```

このように、同じ「商品」でも、文脈によって全く異なる意味を持ちます。これらを無理に統一すると、各国（コンテキスト）の業務が複雑になってしまいます。

### 文化の違いを尊重する

フランスワインとドイツビール、イタリアンパスタと日本のラーメン。それぞれの国の文化に根ざした製品は、その文化の中でこそ真価を発揮します。

同様に、各コンテキストの「文化」（ビジネスロジック）を尊重することが重要です：

**営業文化の「顧客」**
- 購買意欲のレベル分け（ホット、ウォーム、コールド）
- 商談の進捗管理
- 予算と決裁権限の把握

**サポート文化の「顧客」**
- サポート履歴
- 満足度スコア
- 問題解決までの時間

これらを一つの「顧客」モデルに統合しようとすると、両方の文化が損なわれます。

## 外交関係の設計

### 国家間の関係パターン

国際関係には様々なパターンがあります。これらは、コンテキスト間の関係設計にも応用できます。

**1. 同盟関係（Partnership）**
- EU のような対等な協力関係
- 共通の目標に向けた協働
- 相互の利益を重視

**2. 従属関係（Customer-Supplier）**
- 宗主国と植民地のような力関係
- 一方が他方の要求に応じる
- 明確な主従関係

**3. 翻訳外交（Anti-corruption Layer）**
- 国連のような仲介機関
- 文化の違いを吸収
- 独立性を保ちながら協力

**4. 共通市場（Shared Kernel）**
- 共通通貨のような共有要素
- 最小限の共通ルール
- それ以外は各国の自由

### 通商条約の締結

国家間の貿易には明確な取り決めが必要です。コンテキスト間も同様です。

**貿易協定の要素：**

```
【在庫管理国 ⇔ 販売国　通商条約】

第1条（輸出入品目）
- 在庫管理国は「在庫情報」を輸出する
- 販売国は「注文情報」を輸出する

第2条（品質基準）
- 在庫情報は99.9%の精度を保証
- 更新頻度は5分以内

第3条（関税＝変換規則）
- SKUから販売商品IDへの変換表を維持
- 在庫数の解釈（予約在庫の扱い）

第4条（紛争解決）
- データ不整合時の優先順位
- エスカレーションプロセス
```

## 国境の管理

### 入国管理（Anti-corruption Layer）

国境では、パスポートコントロールや税関検査が行われます。これは国の安全と秩序を守るためです。

ソフトウェアでも、外部からのデータを無条件に受け入れることは危険です：

**入国審査の実装：**
1. **パスポートチェック**：データの妥当性検証
2. **ビザの確認**：アクセス権限の確認
3. **税関検査**：データの変換と検疫
4. **入国スタンプ**：監査ログの記録

**具体例：注文データの入国**
```
外国（外部システム）の形式：
- 顧客名：文字列
- 商品：商品名の文字列
- 数量：文字列（"5個"）

入国管理での変換：
- 顧客名 → 顧客ID（内部参照）
- 商品名 → SKU（在庫管理コード）
- "5個" → 数値の5

国内（内部システム）の形式：
- 顧客：Customerエンティティ
- 商品：Productエンティティ
- 数量：整数型
```

### 大使館の設置（API設計）

大使館は、自国の窓口として他国との交流を円滑にします。APIも同様の役割を果たします。

**優れた大使館（API）の特徴：**
1. **明確な所在地**：エンドポイントが分かりやすい
2. **開館時間**：SLAが明確
3. **対応言語**：データフォーマットが標準的
4. **領事サービス**：十分なドキュメンテーション
5. **ビザ発行**：認証・認可の仕組み

## 連邦国家と州の関係

### 適度な自治と統一

アメリカ合衆国やドイツ連邦共和国のように、州の自治を認めながら、連邦として統一された国家もあります。

ソフトウェアシステムでも、このバランスが重要です：

**連邦レベルの統一事項：**
- 認証・認可の仕組み
- 監査ログの形式
- エラーコードの体系
- 基本的なデータ型

**州レベルの自治事項：**
- ビジネスロジックの実装
- データモデルの詳細
- 内部のアーキテクチャ
- 使用する技術スタック

### 州の分離と統合

時に、州が大きくなりすぎて分離することもあれば、小さすぎて統合することもあります。

**分離のサイン：**
- 異なる言語を話す集団ができている
- 変更の影響範囲が部分的
- チームが自然に分かれている
- 異なる品質特性が要求される

**統合のサイン：**
- 頻繁に一緒に変更される
- 同じチームが管理している
- 言語が統一されている
- 過度に細かい通信が発生

## 国境紛争の解決

### 領土問題

歴史上、多くの紛争は領土を巡って起きました。ソフトウェアでも「このデータは誰のものか」という問題は頻発します。

**解決の原則：**
1. **歴史的経緯より現在の責任**：誰が作ったかより、誰が使うか
2. **共同管理より明確な所有**：責任の所在を明確に
3. **コピーによる独立**：必要ならデータを複製して独立性を保つ

### 文化の衝突

異なる文化が接触すると、摩擦が生じることがあります。

**文化衝突の例：**
- 命名規則の違い（camelCase vs snake_case）
- エラー処理の思想（例外 vs エラーコード）
- データの正規化レベル
- トランザクション境界の考え方

**解決方法：**
- 境界での明確な変換
- それぞれの文化の尊重
- 共通のインターフェース仕様
- 定期的な外交会議（チーム間ミーティング）

## 国際連合としての統合

### 共通の課題への対処

気候変動や感染症のように、一国では解決できない課題もあります。システムでも、認証、監査、セキュリティなどは共通の取り組みが必要です。

**システムの国連機能：**
- 共通認証基盤（パスポート）
- 監査ログ統合（国際司法）
- セキュリティポリシー（国際法）
- 共通メトリクス（統計基準）

これらは各国（コンテキスト）の主権を侵害せず、協調のための仕組みとして機能します。

## まとめ：多様性の中の統一

境界づけられたコンテキストは、単なる技術的な分割ではありません。それは、異なる文化（ビジネスドメイン）が共存し、それぞれの強みを活かしながら、全体として一つの目的を達成するための知恵なのです。

優れた国際社会のように：
1. **境界の明確化**：曖昧な境界は紛争の元
2. **文化の尊重**：画一化より多様性
3. **対等な関係**：支配より協調
4. **共通の価値観**：最小限の共通ルール
5. **平和的な交流**：明確なインターフェース

次章では、これらの国家が守るべき「憲法」にあたる非機能要件について探求します。美しい都市や豊かな文化も、安全と秩序なくしては成り立ちません。

---

## 演習問題

1. **言語地図の作成**：あなたの組織で「顧客」「商品」「注文」という言葉が、部門によってどのように異なる意味を持つか調査し、「言語地図」を作成してください。

2. **外交関係の分析**：現在のシステム間連携を国際関係になぞらえて分析してください。それぞれの関係は、同盟、従属、共通市場のどのパターンに当てはまりますか？

3. **国境設計演習**：ECサイトを例に、「商品管理国」「在庫管理国」「注文管理国」「配送国」の境界を設計し、それぞれの通商条約（API仕様）を定義してください。