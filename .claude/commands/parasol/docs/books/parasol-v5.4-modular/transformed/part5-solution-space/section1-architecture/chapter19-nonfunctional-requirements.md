# 第19章　非機能要件の実現 ― 建築物の見えない基礎

## はじめに：氷山の下に隠れた9割

タイタニック号が沈没したのは、氷山の見える部分だけを見て、水面下の巨大な塊を見落としたからでした。ソフトウェアシステムも同じです。ユーザーが目にする機能は氷山の一角に過ぎず、システムの真の価値と安定性は、水面下の「見えない品質」によって支えられています。

建築に例えるなら、美しい外観の建物も、強固な基礎、適切な配管、信頼できる電気系統なしには成り立ちません。地震に耐える構造、火災から守る防火設備、快適な空調システム。これらは普段は意識されませんが、建物の価値を決定づける重要な要素です。

本章では、これらの「見えない品質」― 性能、セキュリティ、可用性、保守性などの非機能要件を、どのように建築物の基礎のように堅固に築いていくかを探求します。

## 建築基準法としての品質特性

### 建築物に求められる基準

日本の建築基準法は、建物が満たすべき最低限の基準を定めています。耐震性、防火性、採光、換気など、住む人の安全と健康を守るための規定です。

ソフトウェアにも同様の「建築基準」があります。ISO/IEC 25010は、ソフトウェアの品質特性を体系化した国際標準です：

**ソフトウェアの建築基準：**

1. **構造強度（信頼性）**
   - 耐震性 → 障害への耐性
   - 耐久性 → 長期間の安定稼働
   - 復旧性 → 障害からの回復力

2. **防犯設備（セキュリティ）**
   - 施錠システム → 認証・認可
   - 監視カメラ → 監査ログ
   - 警報装置 → 侵入検知

3. **居住性能（使用性）**
   - 動線設計 → ユーザーインターフェース
   - バリアフリー → アクセシビリティ
   - 採光・換気 → レスポンス性能

4. **メンテナンス性（保守性）**
   - 配管の点検口 → ログとモニタリング
   - 設備の交換容易性 → モジュール性
   - 図面の整備 → ドキュメント

## 構造計算：性能要件の設計

### 建物の構造計算

高層ビルを建てる前に、構造計算を行います。想定される荷重、風圧、地震力に対して、建物が安全に立っていられるかを科学的に検証します。

ソフトウェアの性能設計も、同様の「構造計算」が必要です：

**性能の構造計算：**

1. **荷重計算（負荷予測）**
   ```
   通常時の居住者：1,000人（通常負荷：1,000 TPS）
   イベント時の来客：5,000人（ピーク負荷：5,000 TPS）
   最大収容人数：10,000人（限界負荷：10,000 TPS）
   ```

2. **応力分析（ボトルネック分析）**
   - どこに負荷が集中するか
   - どの部分が最初に限界を迎えるか
   - 補強が必要な箇所はどこか

3. **安全率の設定**
   ```
   設計荷重 = 予想最大荷重 × 安全率(1.5〜2.0)
   ```

### 免震・制震構造としてのアーキテクチャ

現代の高層ビルは、地震の揺れを吸収する免震・制震構造を持っています。

**システムの免震構造：**

1. **キャッシュ層（免震ゴム）**
   - 直接的な負荷を吸収
   - データベースへの衝撃を緩和
   - 柔軟な応答を実現

2. **メッセージキュー（制震ダンパー）**
   - 急激な負荷変動を平準化
   - システム間の振動を吸収
   - 非同期処理による緩衝

3. **ロードバランサー（柔構造）**
   - 負荷を分散して受け流す
   - 単一障害点を排除
   - 全体としての柔軟性を確保

## 防災設備：セキュリティの実装

### 多層防御という考え方

優れた建物は、複数の防災設備を組み合わせて安全を確保します。防火扉、スプリンクラー、避難経路、非常用電源。一つが機能しなくても、他でカバーできる多層防御です。

**セキュリティの多層防御：**

1. **外周警備（境界防御）**
   - 高い塀 → ファイアウォール
   - 正門の警備 → WAF（Web Application Firewall）
   - 監視カメラ → IDS/IPS

2. **建物入口（認証層）**
   - オートロック → 多要素認証
   - 管理人 → 認証サービス
   - 入館記録 → アクセスログ

3. **各階のセキュリティ（認可層）**
   - フロアごとの入室制限 → ロールベースアクセス制御
   - 重要室の追加認証 → 追加の権限チェック
   - 動線の制限 → 最小権限の原則

4. **金庫室（データ保護）**
   - 耐火金庫 → 暗号化ストレージ
   - 二重扉 → 暗号化通信
   - 指紋認証 → フィールドレベル暗号化

### 防災訓練としてのセキュリティテスト

建物では定期的に防災訓練を行います。同様に、システムでもセキュリティの訓練が必要です：

**セキュリティ訓練の種類：**
- **避難訓練** → インシデント対応訓練
- **消火訓練** → 侵入検知と対応
- **防災査察** → ペネトレーションテスト
- **設備点検** → 脆弱性スキャン

## ライフライン：可用性の確保

### 電気・水道・ガスの冗長性

生活に欠かせないライフラインは、複数の供給経路を持つことで信頼性を高めています。

**システムのライフライン設計：**

1. **電力供給（コンピューティングリソース）**
   ```
   主電源：メインのデータセンター
   予備電源：セカンダリデータセンター
   非常用発電機：オートスケーリング
   UPS：インメモリキャッシュ
   ```

2. **水道（データフロー）**
   ```
   上水道：プライマリデータベース
   予備水源：レプリカデータベース
   貯水槽：データキャッシュ
   配管の二重化：複数の通信経路
   ```

3. **通信（ネットワーク）**
   ```
   固定電話：専用線接続
   携帯電話：インターネット接続
   衛星電話：バックアップ回線
   ```

### 24時間365日の生活を支える

マンションの管理人が24時間常駐するように、システムも継続的な見守りが必要です：

**24/365運用の要素：**

1. **管理人室（監視センター）**
   - 防災盤 → 統合監視ダッシュボード
   - 各種警報 → アラート通知
   - 巡回記録 → メトリクス収集

2. **定期点検**
   - エレベーター点検 → ヘルスチェック
   - 消防設備点検 → セキュリティ監査
   - 清掃 → ログローテーション

3. **緊急対応体制**
   - 管理会社 → 運用チーム
   - 修理業者 → エンジニア
   - 緊急連絡網 → エスカレーション

## 建物の長寿命化：保守性の設計

### リフォームしやすい建築

スケルトン・インフィル方式の建築では、構造体（スケルトン）と内装・設備（インフィル）を分離することで、将来の改修を容易にします。

**ソフトウェアのスケルトン・インフィル：**

1. **スケルトン（変わりにくい部分）**
   - 基本的なアーキテクチャ
   - コアとなるドメインモデル
   - 主要なインターフェース

2. **インフィル（変わりやすい部分）**
   - UI の実装
   - 外部サービスとの連携
   - ビジネスルールの詳細

### 建築図面としてのドキュメント

建物の改修には、正確な図面が不可欠です。配管がどこを通っているか、柱がどこにあるか。これらの情報なしに、安全な改修はできません。

**システムの建築図面：**
1. **意匠図** → 画面設計書
2. **構造図** → アーキテクチャ図
3. **設備図** → インフラ構成図
4. **配線図** → データフロー図

## 性能証明：非機能要件の検証

### 建築確認申請

建物を建てる前に、建築確認申請で設計の妥当性を証明します。完成後は完了検査で、設計通りに建築されたことを確認します。

**システムの建築確認：**

1. **設計審査**
   ```
   性能要件：応答時間 < 100ms
   計算根拠：キャッシュヒット率90%を前提
   実現方法：3層キャッシュアーキテクチャ
   ```

2. **施工確認（性能テスト）**
   ```
   負荷試験：設計通りの耐荷重を確認
   耐久試験：長時間の運転に耐えるか
   限界試験：どこまで耐えられるか
   ```

3. **完了検査（受け入れテスト）**
   ```
   ✓ 性能基準を満たしている
   ✓ セキュリティ要件を充足
   ✓ 可用性目標を達成
   ✓ 運用手順が整備されている
   ```

### 定期検査制度

建築物は、建築後も定期的な検査が義務付けられています。外壁、エレベーター、消防設備など、安全に関わる部分は専門家による検査が必要です。

**システムの定期検査：**
- **日次点検**：ヘルスチェック、バックアップ確認
- **週次点検**：パフォーマンスレビュー、容量確認
- **月次点検**：セキュリティパッチ、依存関係更新
- **年次点検**：アーキテクチャレビュー、DR訓練

## 住み心地の追求：品質の統合

### 総合的な住環境

優れた建築は、個々の要素が優れているだけでなく、全体として快適な住環境を提供します。採光と通風、動線と収納、プライバシーと開放感。これらのバランスが住み心地を決定します。

**システムの住み心地：**
1. **使いやすさと安全性のバランス**
2. **高速性と確実性の調和**
3. **柔軟性と堅牢性の両立**
4. **コストと品質の最適化**

### 経年優化

良い建築は、時間とともに味わいを増します。使い込まれた木の床、手入れされた庭、住む人とともに成長する家。

**システムの経年優化：**
- **データの蓄積** → より賢い推薦
- **運用知見の蓄積** → より安定した運用
- **ユーザーの習熟** → より効率的な利用
- **継続的な改善** → より高い品質

## まとめ：見えない品質への投資

非機能要件は、建築物の基礎工事のようなものです。完成後は見えなくなりますが、建物の価値と寿命を決定づけます。手を抜けば、後で大きな代償を払うことになります。

優れた建築のように：
1. **設計段階での十分な検討** - 後からの補強は困難でコスト高
2. **多層的な対策** - 単一の対策に頼らない
3. **定期的な点検と保守** - 予防は治療に勝る
4. **住む人（ユーザー）の視点** - 技術のための技術ではない
5. **長期的な視点** - 初期コストより生涯コスト

次はいよいよ、この堅固な基礎の上に、実際のビジネスロジックという「建築物」を建てていきます。第20章では、ドメインモデリングの技法を詳しく見ていきましょう。

---

## 演習問題

1. **建築基準の策定**：あなたのシステムに必要な「建築基準」を定めてください。性能、セキュリティ、可用性それぞれについて、具体的な数値目標と、それを実現するための「建築工法」を提案してください。

2. **構造計算演習**：年末セールで通常の10倍のアクセスが予想されるECサイトを想定し、必要な「構造補強」を設計してください。どこがボトルネックになり、どのような対策が必要でしょうか。

3. **防災計画立案**：データベースの完全停止、大規模なDDoS攻撃、内部からの情報漏洩の3つのシナリオに対する「防災計画」を作成してください。予防、検知、対応、復旧の各段階で何をすべきか明確にしてください。