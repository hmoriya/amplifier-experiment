# 第5章：Axiomatic Designと設計公理

**Parasol V5.4新章**

---

## 本章の目的

本章では、Parasol V5.4で統合されたAxiomatic Design（公理的設計）の理論と、その実践的な適用方法について解説します。「良い設計」を主観ではなく、科学的・客観的に判断できるようになることを目指します。

## 本章で学ぶこと

- Axiomatic Designの基本概念（FR・DP）
- 2つの設計公理（独立公理・情報公理）
- Design Matrixによる設計品質の可視化
- Parasol V5における公理の適用方法
- ビジネス時間的凝集（WHEN軸）という新概念

---

## 5.1 なぜ設計公理が必要か

### 従来の設計レビューの問題点

設計レビューでよく聞かれる言葉：
- 「なんとなく複雑な気がする」
- 「依存関係が多すぎる感じがする」
- 「もっとシンプルにできないか」

これらの評価は主観的で、人によって判断が異なります。

### 科学的アプローチの必要性

```
従来のアプローチ          Axiomatic Designアプローチ
├── 経験と勘             ├── 測定可能な基準
├── 主観的判断           ├── 客観的評価
└── 属人的               └── 再現可能
```

Axiomatic Designは、MITのNam P. Suh教授が提唱した設計理論で、「良い設計」を2つのシンプルな公理で判断します。

---

## 5.2 基本概念：FRとDP

### FR（Functional Requirements）- 機能要件

> **「何を実現するか」（WHAT）**

システムが達成すべき機能や振る舞いを定義したもの。

```
ECサイトの例：
├── FR1: ユーザーが商品を検索できる
├── FR2: ユーザーが商品をカートに追加できる
├── FR3: ユーザーが決済できる
└── FR4: ユーザーが注文履歴を確認できる
```

**Parasol V5での対応**: CL3（業務オペレーション）

### DP（Design Parameters）- 設計パラメータ

> **「どう実現するか」（HOW）**

FRを実現するための具体的な設計要素。

```
ECサイトの例：
├── DP1: 商品検索サービス（Elasticsearch使用）
├── DP2: カート管理サービス（セッション/DB保存）
├── DP3: 決済サービス（Stripe連携）
└── DP4: 注文管理サービス（注文履歴DB）
```

**Parasol V5での対応**: BC（Bounded Context）/ Service

### Parasol V5とAxiomatic Designの対応関係

| Axiomatic Design | Parasol V5 | 説明 |
|-----------------|------------|------|
| FR（機能要件） | CL3（業務オペレーション） | 何を実現するか |
| DP（設計パラメータ） | BC / UseCase / Service | どう実現するか |
| FR-DP対応 | CL3-BC対応 | Design Matrixで評価 |

---

## 5.3 独立公理（Independence Axiom）

### 公理の定義

> **「機能は互いに独立させよ」**

一つのFRを変更したとき、他のFRに影響しない設計が良い設計です。

### 悪い例と良い例

```
❌ 独立公理違反（Coupled）:
  ユーザー登録機能を変更すると...
    → 決済機能も壊れる
    → 通知機能も壊れる
    → テストが全部やり直し

✅ 独立公理遵守（Uncoupled）:
  ユーザー登録機能を変更しても...
    → 決済機能は影響なし
    → 通知機能は影響なし
    → その機能のテストだけでOK
```

### ビジネスへの影響

| 独立公理違反 | 独立公理遵守 |
|-------------|-------------|
| 変更リスクが高い | 変更が安全 |
| テスト工数が大きい | テスト工数が小さい |
| 開発スピードが遅い | 開発スピードが速い |
| 障害が連鎖する | 障害が局所化する |

### Parasol V5での実践

Phase 3とPhase 4で独立公理を適用：

1. **CL3間の独立性確保**（Phase 3）
   - 業務オペレーション間の依存を最小化
   - 共有データの削減

2. **BC間の独立性確保**（Phase 4）
   - Customer-Supplierパターンの活用
   - 循環依存の排除

---

## 5.4 情報公理（Information Axiom）

### 公理の定義

> **「成功確率を最大化せよ」**

設計が正しく機能する確率が最も高い選択肢を選ぶべきです。

### なぜ「シンプル」ではなく「成功確率」か

原典の定義：
```
情報量 I = log₂(1/p)
p = 設計が機能要件を満たす確率
```

- 成功確率が高い → 情報量が少ない → 結果としてシンプルに見える
- 「シンプル」は結果であり、原因ではない

### 悪い例と良い例

```
❌ 情報公理違反（成功確率が低い）:
  商品管理システム
  ├── 商品マスタBC
  │   ├── 基本情報サービス
  │   ├── 価格サービス
  │   ├── 在庫サービス
  │   ├── カテゴリサービス
  │   ├── タグサービス
  │   ├── 画像サービス
  │   └── SEOサービス ← 7つのサービス！過剰分割

✅ 情報公理遵守（成功確率が高い）:
  商品管理システム
  ├── 商品BC
  │   ├── 商品サービス（基本・価格・在庫）
  │   └── 表示サービス（画像・SEO）
  └── カタログBC
      └── カテゴリサービス ← 必要最小限！
```

### Parasol V5での実践

各フェーズで情報公理を適用：

1. **VL階層の最小化**（Phase 2）
   - 階層深度 ≤ 3
   - 重複の排除

2. **BC数の最小化**（Phase 4）
   - BC数/CL3数 ≤ 1.2
   - N:1統合の推進

3. **Aggregate数の制限**（Phase 5）
   - 各BC内で3-7個
   - 認知負荷の管理

---

## 5.5 Design Matrixによる設計評価

### Design Matrixとは

FR（機能要件）とDP（設計パラメータ）の関係を可視化する行列です。

```
        設計パラメータ（HOW）
              DP1    DP2    DP3
機        FR1 [ X     0      0  ]
能        FR2 [ 0     X      0  ]
要        FR3 [ 0     0      X  ]
件
（WHAT）

X = 関係あり、0 = 関係なし
```

### 3つのパターン

#### Uncoupled（独立） ✅ 最良
```
     DP1   DP2   DP3
FR1 [ X     0     0  ]
FR2 [ 0     X     0  ]
FR3 [ 0     0     X  ]
```
どの機能も独立して変更可能

#### Decoupled（順序依存） △ 許容
```
     DP1   DP2   DP3
FR1 [ X     0     0  ]
FR2 [ X     X     0  ]
FR3 [ 0     X     X  ]
```
順番に変更すればOK

#### Coupled（結合） ❌ 再設計が必要
```
     DP1   DP2   DP3
FR1 [ X     X     0  ]
FR2 [ X     X     X  ]
FR3 [ 0     X     X  ]
```
どこを変えても影響が予測不能

### Parasol V5でのDesign Matrix活用

Phase 4でCL3↔BC対応をDesign Matrixで評価：

```
        BC-A   BC-B   BC-C
CL3-001 [ X     0     0  ]  → 商品検索はBC-Aのみ
CL3-002 [ 0     X     0  ]  → カート管理はBC-Bのみ
CL3-003 [ 0     0     X  ]  → 決済処理はBC-Cのみ
```

---

## 5.6 ビジネス時間的凝集（WHEN軸）- Parasol V5の革新

### 従来設計の問題点

従来の設計は「モノ/機能」（WHAT）で分割するため：

```
ビジネス要求: 「認知を改善したい」
         ↓
従来設計: 商品BC + マーケティングBC + 顧客BC + ...
         ↓
結果: 変更が複数BCに波及、調整コスト膨大
```

### Parasol V5の解決策

価値ステージ（WHEN）を第一分割軸に：

```
Phase 2: 顧客ジャーニー（WHEN軸）で分割
  VS1(認知) → VS2(理解) → VS3(実践) → ...

結果:
  「認知改善」→ VS1内の変更で完結
  「購入体験改善」→ VS4内の変更で完結
```

### 凝集度理論の拡張

| 従来の時間的凝集 | ビジネス時間的凝集 |
|-----------------|-------------------|
| 技術的タイミング | 顧客ジャーニーの段階 |
| 「起動時に実行」 | 「認知形成時に必要」 |
| ビジネス意味なし | ビジネス意味あり |
| 凝集度: 弱い ⚠️ | 凝集度: 強い ✅ |

---

## 5.7 フェーズ別公理適用マップ

### 各フェーズでの適用

```
┌─────────────────────────────────────────────────────────┐
│          Parasol V5 公理適用マップ                       │
├─────────────────────────────────────────────────────────┤
│ Phase 2  │ 情報公理 │ VL≤3階層、VS=5-8               │
│ Phase 3  │ 独立公理 │ CL3間の独立性確保               │
│ Phase 4  │ 両公理   │ Design Matrix評価              │
│ Phase 5  │ 情報公理 │ BC内部構造の簡素化              │
│ Phase 6  │ 独立公理 │ Service間の循環依存ゼロ         │
└─────────────────────────────────────────────────────────┘
```

### チェックポイント

Phase 4でDesign MatrixがCoupledの場合：
- **即座にPhase 2-3に戻って再設計**
- 無理に進むと技術的負債が雪だるま式に増加

---

## 5.8 実践演習

### 演習1：Design Matrix作成

以下のシステムのDesign Matrixを作成し、評価してください：

```
機能要件（FR）:
- FR1: 在庫を確認できる
- FR2: 在庫を予約できる
- FR3: 予約を確定できる

設計パラメータ（DP）:
- DP1: 在庫サービス
- DP2: 予約サービス
- DP3: 決済サービス
```

### 演習2：情報公理の適用

以下の2つの設計案のうち、情報公理に従うとどちらが良いか判断してください：

案A: 10個のマイクロサービス
案B: 3個のサービス（機能をグループ化）

### 演習3：ビジネス時間的凝集の実践

ECサイトの「商品レビュー機能」を、従来設計とParasol V5設計で比較してください。

---

## 5.9 まとめ

### 本章のポイント

1. **2つの公理を覚える**
   - 独立公理：機能は互いに独立させよ
   - 情報公理：成功確率を最大化せよ

2. **Design Matrixで可視化**
   - Uncoupled（独立）を目指す
   - Coupledは必ず再設計

3. **ビジネス時間的凝集**
   - WHEN軸での分割が変更容易性を生む
   - 従来のWHAT軸分割の限界を克服

### 次章への架橋

第6章では、これらの設計公理を念頭に置きながら、Phase 0-1のプロジェクト基盤構築について学びます。最初から公理を意識した設計を行うことで、後続フェーズでの手戻りを防ぎます。

---

## 参考文献

- Nam P. Suh, "The Principles of Design" (Oxford University Press, 2001)
- [zigzag-foundations.md](../../philosophy/zigzag-foundations.md) - ZIGZAG思想的基盤
- [axiomatic-design-intro.md](../../guides/axiomatic-design-intro.md) - Axiomatic Design入門
- [philosophy-checkpoints.md](../../philosophy/philosophy-checkpoints.md) - 哲学チェックポイント

---

**次章**: [第6章：Phase 0-1：プロジェクト基盤構築](../part2-understanding/chapter5-phase0-1.md)