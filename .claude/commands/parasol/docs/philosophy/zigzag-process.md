# Parasol V5 - 価値駆動ZIGZAGプロセス

## 概要

Parasol V5は、価値からソフトウェア実装まで、ZIGZAGプロセスで体系的に分解します。

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         Parasol V5 - 3層構造                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  Phase 1: WHY領域（なぜこのビジネスか）                                         │
│  ─────────────────────────────────────────────────────────────────────────────  │
│    Context: 組織・市場・制約・存在意義                                          │
│                                                                                 │
│  Phase 2: WHAT領域（何を実現するか）← 価値のZIGZAG                              │
│  ─────────────────────────────────────────────────────────────────────────────  │
│    VL1→VL2→VL3: 価値分解（同領域内で分解）                                     │
│    VMS/VS: 価値実現フロー                                                       │
│                                                                                 │
│  Phase 3-6: WHAT領域 ↔ HOW領域（どう実現するか）← ビジネス・設計のZIGZAG       │
│  ─────────────────────────────────────────────────────────────────────────────  │
│    WHAT領域（問題空間）: CL1→CL2→CL3（同領域内で分解）                         │
│    HOW領域（解決空間）: BC→Service→実装（同領域内で分解）                      │
│    ※ つまり時のみ領域間を移動（ZIGZAG）                                        │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## ZIGZAGの本質

### 学術的背景：Axiomatic Design

ZIGZAGは設計理論において確立された概念である。MIT Suh教授のAxiomatic Designでは：

> "**zig-zagging and hierarchical technique passing from functional domain to design parameters domain**"

と定義されており、機能領域（WHAT）と設計パラメータ領域（HOW）の間を行き来する手法として知られている。

### 核心的定義

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    ZIGZAG = つまり時の領域間移動による創発                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  【重要】WHAT/HOWは「レベル」ではなく「領域」                                    │
│                                                                                 │
│    WHAT領域（問題空間）              HOW領域（解決空間）                        │
│    ┌─────────────────────┐          ┌─────────────────────┐                    │
│    │  同領域内では        │          │  同領域内では        │                    │
│    │  分解を続ける        │  ZIGZAG  │  分解を続ける        │                    │
│    │  CL1→CL2→CL3        │←────────→│  BC→Service→実装    │                    │
│    │                     │ つまり時 │                     │                    │
│    └─────────────────────┘          └─────────────────────┘                    │
│                                                                                 │
│  • 同じ領域内では分解を継続（WHAT→WHAT、HOW→HOW）                              │
│  • 「つまり」が発生した時のみ、別領域へ移動（ZIGZAG）                           │
│  • 別領域での分解が、元の領域の理解を深める（創発）                             │
│  • 螺旋的に繰り返す：同じ領域に戻るが、より高次の理解で                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### なぜWHATは分解できなくなるのか

WHATが分解できなくなるのは「語彙の欠如」による。これは問題空間の解像度不足であり、抽象概念を構成する要素が見えていない状態。

```
例: 「認証機能」（WHAT）
  ↓ これ以上分解しようとしても...
  「認証を...する...機能？」（行き詰まり）
```

**行き詰まりの正体**: 同一抽象レベルでの思考の飽和。同じ語彙空間をぐるぐる回っている状態。

### HOW領域への移動がWHAT領域の理解を深めるメカニズム

「つまり」が発生した時、HOW領域へ移動して分解することで、WHAT領域の理解が深まる。

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  WHAT領域（問題空間）                    HOW領域（解決空間）                     │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  「認証機能」                                                                   │
│       │                                                                         │
│       ▼ 分解しようとする                                                        │
│       ？                                                                        │
│    （つまり）                                                                   │
│    これ以上                              「どう実装する？」                      │
│    分解できない ─────────── ZIGZAG ─────▶      │                               │
│                                                ▼ HOW領域で分解                  │
│                                          ┌─────────────────┐                    │
│                                          │ OAuth           │                    │
│                                          │ JWT発行         │                    │
│                                          │ セッション管理  │                    │
│                                          └─────────────────┘                    │
│                                                │                                │
│  ┌─────────────────┐                           │                                │
│  │ トークン管理    │ ◀───────── 創発！ ────────┘                                │
│  │ リフレッシュ戦略│      HOW領域の分解が                                       │
│  │ 失効処理        │      WHAT領域の理解を深める                                │
│  └─────────────────┘                                                            │
│       ↑                                                                         │
│   WHAT領域で新しい概念が見える                                                  │
│   （より高次の理解）                                                            │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**重要な洞察**: これは「レベル間の移動」ではなく「領域間の移動」。HOW領域で分解することで、元のWHAT領域に暗黙に含まれていた未言語化概念が顕在化する（創発）。

### 思想的根源：老子「反者道之動」

ZIGZAGの根源にある東洋思想 ─ 道徳経第40章：

```
反者道之動    （かえるは みちの うごきなり）
弱者道之用    （よわきは みちの ようなり）
有生於無      （ゆうは むより しょうず）
```

| 老子の教え | ZIGZAGへの示唆 |
|-----------|---------------|
| **反者道之動** | 問題空間⟷解決空間の往復こそが創発の動力源 |
| **弱者道之用** | 詰まりに抗わず、柔軟に転換することで前進 |
| **有生於無** | HOW（無形の問い）からWHAT'（有形の概念）が創発 |

> 詳細は [zigzag-foundations.md](./zigzag-foundations.md) を参照

### 他分野での類似パターン

| 分野 | パターン | ZIGZAGとの対応 |
|------|----------|---------------|
| **設計理論** | Axiomatic Design（MIT Suh） | 機能領域↔設計パラメータ領域のzig-zagging |
| **東洋思想** | 反者道之動（老子） | 反転・循環こそ道の動力 = ZIGZAG |
| **認知科学** | 図と地の反転（Gestalt） | WHAT領域が見えなくなったらHOW領域に転換 |
| **システム思考** | ダブルループ学習（Argyris） | 前提自体を問い直す = 領域移動 |
| **哲学** | 弁証法（ヘーゲル） | 正(WHAT)→反(HOW)→合(創発) |
| **DDD** | Problem/Solution Space | 問題空間↔解決空間の往復 |

### 従来手法との違い

| 手法 | 進行パターン | 限界 |
|------|-------------|------|
| トップダウン | WHAT→WHAT→WHAT | 抽象度の壁で停止 |
| ボトムアップ | HOW→HOW→HOW | 全体像を見失う |
| **ZIGZAG** | WHAT↔HOW交互 | 壁を迂回して進む |

### なぜ3層か

3層は「認識の最小完結単位」：

- **2層**: 対立のみ（WHAT vs HOW）→ 緊張は生まれるが解決しない
- **3層**: 対立 + 止揚（WHAT'の創発）→ 弁証法的完結
- **4層以上**: 3層の入れ子として還元可能

---

## 保存すべき緊張（未解決の問い）

ZIGZAGには以下の未解決の問いがあり、これらは安易に解消せず設計判断時に意識的に参照すべき：

### 1. 「分解できない」の多義性

| 解釈 | 意味 | 対処 |
|------|------|------|
| **存在論的限界** | 本質的に分割不可能な原子単位 | HOWで確認 |
| **認識論的限界** | 現時点の知識/文脈で見えない | HOWで顕在化 |

→ どちらの場合もHOWへの移行が有効なら、実践的には区別不要かもしれない

### 2. 分解の「正しさ」の基準

- 後のHOWが容易になること？
- 実装可能性？
- 美的一貫性？
- → **事後的にしか判断できない可能性**

### 3. ZIGZAGは必然か選択肢か

- トップダウンのみでも成功する場合がある
- 文脈依存の戦略であり、普遍法則ではない可能性
- → **適用判断が必要**

---

## 実践ガイド：「詰まり」の検知と突破

### 詰まりの検知シグナル

以下が発生したら、WHATでの思考が飽和している：

1. **同じ単語が3回以上繰り返される**
   - 「顧客管理...顧客を管理...管理する顧客...」

2. **「つまり」で言い換えても新情報がない**
   - 「認証機能、つまりユーザーを認証する機能」

3. **抽象度が変わらない**
   - 上にも下にも行けない膠着状態

### 突破方法：強制的HOW転換

```
詰まり検知
  ↓
「これをどう実装/実現するか？」と強制的に問う
  ↓
具体的な手段・技術・活動を列挙
  ↓
各HOWから見えてくる新しいWHATを言語化
  ↓
新しいWHAT（WHAT'）を記録して次へ
```

### Phase間ハンドオフでの活用

```
前Phase出力（WHAT）
    ↓ 次Phaseで「どう？」を問う
次Phase（HOW視点で見る）
    ↓ 発見された新WHAT'を
次Phase出力に明示的に追加
```

---

## 2段階ZIGZAGモデル

Parasol V5のZIGZAGは2つの段階で構成されます：

1. **第1段階: 価値のZIGZAG** - 何を実現するか（Value Domain）
2. **第2段階: ビジネスと設計のZIGZAG** - どう実現するか（Problem Space ↔ Solution Space）

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                      Parasol V5 - 2段階ZIGZAGモデル                                 │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ╔═══════════════════════════════════════════════════════════════════════════════╗ │
│  ║ 【第1段階】価値のZIGZAG（Value Domain）                                        ║ │
│  ║                                                                               ║ │
│  ║   WHAT           HOW           WHAT'          HOW'                            ║ │
│  ║   何を？         どう分解？     いつ実現？     どう進める？                    ║ │
│  ║      │              │             │              │                            ║ │
│  ║      ▼              ▼             ▼              ▼                            ║ │
│  ║   ┌──────┐      ┌──────────┐  ┌──────────┐  ┌──────────────┐                  ║ │
│  ║   │ VL1  │ ──→ │ VL2→VL3  │─→│VMS5→VMS1 │─→│  VS0 → VS7   │                  ║ │
│  ║   │最上位│      │価値分解   │  │バック    │  │バリュー     │                  ║ │
│  ║   │価値  │      │（詳細化） │  │キャスト  │  │ステージ     │                  ║ │
│  ║   └──────┘      └──────────┘  └──────────┘  └──────────────┘                  ║ │
│  ║                                                   │                           ║ │
│  ╚═══════════════════════════════════════════════════╪═══════════════════════════╝ │
│                                                      │                             │
│                                                      ▼ 価値定義完了                │
│                                                                                     │
│  ╔═══════════════════════════════════════════════════════════════════════════════╗ │
│  ║ 【第2段階】ビジネスと設計のZIGZAG（Problem Space ↔ Solution Space）           ║ │
│  ║                                                                               ║ │
│  ║  ┌─────────────────────────────────────────────────────────────────────────┐ ║ │
│  ║  │ 問題空間（Problem Space）── WHAT を深掘り                              │ ║ │
│  ║  │                                                                         │ ║ │
│  ║  │   WHAT          HOW           WHAT'                                     │ ║ │
│  ║  │   何の領域？     どう組織？     何をする？                               │ ║ │
│  ║  │      │             │              │                                     │ ║ │
│  ║  │      ▼             ▼              ▼                                     │ ║ │
│  ║  │   ┌──────┐     ┌──────────┐   ┌──────────┐                              │ ║ │
│  ║  │   │ CL1  │ ─→ │   CL2    │ ─→│   CL3    │                              │ ║ │
│  ║  │   │活動  │     │ケイパ   │   │業務OP   │                              │ ║ │
│  ║  │   │領域  │     │ビリティ │   │定義     │                              │ ║ │
│  ║  │   │(傾向)│     │(★正式)  │   │(網羅)   │                              │ ║ │
│  ║  │   └──────┘     └──────────┘   └──────────┘                              │ ║ │
│  ║  │                                     │                                   │ ║ │
│  ║  └─────────────────────────────────────┼───────────────────────────────────┘ ║ │
│  ║                                        │                                     ║ │
│  ║  ══════════════════════════════════════╪════════════════════════════════════ ║ │
│  ║  問題空間 ↑ ──────────────────────────╋──────────────────── ↓ 解決空間     ║ │
│  ║  ══════════════════════════════════════╪════════════════════════════════════ ║ │
│  ║                                        │                                     ║ │
│  ║  ┌─────────────────────────────────────┼───────────────────────────────────┐ ║ │
│  ║  │ 解決空間（Solution Space）── HOW を設計                                │ ║ │
│  ║  │                                     ▼                                   │ ║ │
│  ║  │   WHAT          HOW           WHAT'                                     │ ║ │
│  ║  │   何を境界に？   どう実装？     何を作る？                               │ ║ │
│  ║  │      │             │              │                                     │ ║ │
│  ║  │      ▼             ▼              ▼                                     │ ║ │
│  ║  │   ┌──────┐     ┌──────────┐   ┌──────────┐                              │ ║ │
│  ║  │   │ BC   │ ─→ │ Service  │ ─→│ 実装     │                              │ ║ │
│  ║  │   │境界  │     │ドメイン │   │コード   │                              │ ║ │
│  ║  │   │確定  │     │モデル   │   │テスト   │                              │ ║ │
│  ║  │   │Ph4   │     │   Ph5   │   │  Ph6    │                              │ ║ │
│  ║  │   └──────┘     └──────────┘   └──────────┘                              │ ║ │
│  ║  │                                                                         │ ║ │
│  ║  └─────────────────────────────────────────────────────────────────────────┘ ║ │
│  ║                                                                               ║ │
│  ╚═══════════════════════════════════════════════════════════════════════════════╝ │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2段階ZIGZAGの構造

### 第1段階: 価値のZIGZAG（Phase 2）

| ステップ | 問い | 成果物 | 役割 |
|---------|------|--------|------|
| **WHAT: VL1** | 何を実現する？ | 最上位価値定義 | 価値の宣言 |
| **HOW: VL2→VL3** | どう分解する？ | 価値分解階層 | 価値の構造化 |
| **WHAT': VMS** | いつ実現する？ | 価値マイルストーン | 達成時期の逆算 |
| **HOW': VS0-VS7** | どう進める？ | バリューステージ | 顧客状態遷移 |

### 第2段階: ビジネスと設計のZIGZAG（Phase 3-6）

**問題空間（Problem Space）- Phase 3**

| ステップ | 問い | 成果物 | 役割 |
|---------|------|--------|------|
| **WHAT: CL1** | 何の領域？ | 活動領域識別 | 傾向的分類 |
| **HOW: CL2** | どう組織する？ | ケイパビリティ設計 | ★正式分類 |
| **WHAT': CL3** | 何をする？ | 業務オペレーション | 網羅的定義 |

**解決空間（Solution Space）- Phase 4-6**

| ステップ | 問い | 成果物 | 役割 |
|---------|------|--------|------|
| **WHAT: BC** | 何を境界に？ | BC境界確定 | 技術境界 |
| **HOW: Service** | どう実装する？ | ドメインモデル | 詳細設計 |
| **WHAT': 実装** | 何を作る？ | コード・テスト | 成果物 |

---

## Phaseとの対応

| Phase | 段階 | 空間 | WHAT/HOW | 内容 | 主要成果物 |
|-------|------|------|----------|------|-----------|
| **1** | - | - | 前提 | Context（組織・市場・制約） | organization-analysis.md |
| **2** | **第1段階** | Value | **WHAT→HOW→WHAT'→HOW'** | **価値のZIGZAG** | value-definition.md, VMS, VS |
| **3** | **第2段階** | Problem | **WHAT→HOW→WHAT'** | **CL1→CL2→CL3** | capabilities.md |
| **4** | **第2段階** | Solution | **WHAT** | **BC境界確定** | context-map.md |
| **5** | **第2段階** | Solution | **HOW** | **ドメインモデル設計** | domain-model.md |
| **6** | **第2段階** | Solution | **WHAT'** | **実装** | src/, tests/ |
| **7** | - | - | 基盤 | Platform（インフラ・運用） | infrastructure.md |

---

## 各段階の詳細

### 第1段階: 価値のZIGZAG（Phase 2）

**目的**: ビジネス価値を分解し、マイルストーン成果まで落とし込む

#### VL1→VL2→VL3: 価値分解

- **VL1（WHAT）**: 企業が提供する最上位価値
- **VL2（HOW）**: 価値の構造化・分解
- **VL3（WHAT'）**: 行動可能な構造化価値

```
質問: 「このビジネスは何を実現するのか？」
出力: value-definition.md
```

#### VMS→VS: マイルストーン設計

- **VMS（HOW'）**: 価値実現の段階設計
- **VS（WHAT''）**: マイル成果（VS0-VS7）

```
質問: 「価値はどのように流れるのか？」
出力: value-streams-mapping.md, vs{N}-detail.md
```

---

### 第2段階: ビジネスと設計のZIGZAG（Phase 3-6）

#### Problem Space（問題領域）- Phase 3

**目的**: Value Stageをスイムレーンとしてビジネス要件を分解

##### CL1→CL2: 活動領域からドメイン分類

- **CL1（WHAT）**: 活動領域の識別
- **CL2（HOW）**: ドメイン分類（Core/Supporting/Generic）

```
質問: 「各Stageで何ができる必要があるか？」
出力: activity-area-classification.md, subdomain-design.md

┌──────────┐  ┌──────────┐  ┌──────────┐
│ Stage 1  │  │ Stage 2  │  │ Stage 3  │  ← スイムレーン
├──────────┤  ├──────────┤  ├──────────┤
│ Cap A    │  │ Cap D    │  │ Cap G    │  ← Capability
│ Cap B    │  │ Cap E    │  │ Cap H    │    （サービス候補）
│ Cap C    │  │ Cap F    │  │ Cap I    │
└──────────┘  └──────────┘  └──────────┘
```

##### CL3: 業務オペレーション

- **CL3（WHAT'）**: 各ケイパビリティの具体的業務

```
質問: 「各ケイパビリティでどんな業務を行うか？」
出力: business-operations.md
```

---

#### Solution Space（解決領域）- Phase 4-6

**目的**: 問題領域をDDDで解決領域に変換

##### BC: 境界付きコンテキスト（Phase 4）

- **BC（WHAT）**: サービス境界の確定
- Context Map（サービス間関係）
- API契約の概要

```
質問: 「サービスをどう分割・連携させるか？」
出力: service-boundaries.md, context-map.md

※ここで「サービス枠」をフリーズ
※以降の変更は高コスト
```

##### Service: Software設計（Phase 5）

- **Service（HOW）**: ドメインモデル、API仕様、データベース設計
- ユースケース詳細

```
質問: 「各サービスで何を作るか？」
出力: domain-model.md, api-specs/, database-design.md
```

##### 実装（Phase 6）

- **実装（WHAT'）**: コード生成、テスト、リファクタリング

```
質問: 「どう作るか？」
出力: src/, tests/
```

---

## Value Stage Swimlane パターン

### なぜスイムレーンか

| 観点 | スイムレーン方式 | ボトムアップ方式 |
|------|-----------------|-----------------|
| **サービス境界** | Value Stageで事前確定 | 後から決めるため曖昧に |
| **重複リスク** | 低い（境界が明確） | 高い（ユーザー視点で重複） |
| **修正コスト** | 低い（事前設計） | 高い（結合後の分離困難） |

### スイムレーンの作り方

```
Step 1: Value Streamを特定
        「調達 → 製造 → 販売」

Step 2: 各Stageをスイムレーンとして配置
        ┌────────┐ ┌────────┐ ┌────────┐
        │ 調達   │ │ 製造   │ │ 販売   │
        └────────┘ └────────┘ └────────┘

Step 3: 各スイムレーン内でCapabilityを列挙
        ┌────────┐ ┌────────┐ ┌────────┐
        │原料調達│ │製品開発│ │受注管理│
        │品質検査│ │生産管理│ │出荷管理│
        │在庫管理│ │品質保証│ │顧客管理│
        └────────┘ └────────┘ └────────┘

Step 4: 各Capabilityがサービス候補
        → Phase 4で境界を確定
```

---

## ハイレベルユースケースの位置づけ

### どこで使うか

ハイレベルユースケースは**Level 2（サービス層）のCapability内部**で活用：

```
Capability（サービス候補）
    │
    ├── ハイレベルUC 1: 「顧客が見積もりを依頼する」
    ├── ハイレベルUC 2: 「営業が見積もりを作成する」
    └── ハイレベルUC 3: 「顧客が見積もりを承認する」
```

### なぜこの位置か

- **境界は既に確定**: Value Stageスイムレーンで重複なし
- **中身の充填に最適**: 具体的なシナリオで業務理解を深める
- **ビジネスユーザーが語りやすい**: 抽象的なCapabilityより具体的

---

## DDD用語との対応（技術者向け参照）

| Parasol用語 | DDD用語 | Agile対応 | Core/Supporting/Generic | 備考 |
|-------------|---------|-----------|------------------------|------|
| CL1 (Activity Area) | ≈ Problem Space全体 | Initiative | 傾向的（参考） | 経営層向け |
| CL2 (Capability) | ≈ **Subdomain** | Theme | **正式分類** | 事業部長向け |
| CL3 (Business Operation) | ≈ Domain Model詳細 | Epic/Feature | なし（網羅性重視） | 業務担当者向け |
| Actor UseCase | ≈ UseCase | **User Story** | なし | 開発チーム向け |
| BC (Bounded Context) | = Bounded Context | - | CL2から継承 | アーキテクト向け |
| View | ≈ Presentation | Task | なし | 開発者向け |

> **重要**: CL1の分類はCL2に継承されない。Generic VSでもCore Capabilityが存在しうる。
>
> **シングルアクター原則**: Actor UseCaseは単一アクターの完結操作。Agile User Story（INVEST原則）に対応。

---

## コマンド体系

```bash
# 第1段階: 価値のZIGZAG
/parasol:2-value                    # VL1→VL2→VL3→VMS→VS 価値分解

# 第2段階: ビジネスと設計のZIGZAG
## Problem Space（問題領域）
/parasol:3-capabilities             # CL1→CL2→CL3 ケイパビリティ分解
/parasol:3-capabilities VS1         # 特定VSのCapability

## Solution Space（解決領域）
/parasol:4-architecture             # BC: サービス境界確定
/parasol:5-software [service]       # Service: Software設計
/parasol:6-implementation [service] # 実装: コード生成
```

---

## 重要な原則

### 1. Phase 4でサービス枠をフリーズ

```
Phase 1-4: 設計フェーズ（変更容易）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
           ↓ Phase 4完了 = サービス枠確定
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Phase 5-6: 実装フェーズ（枠内で作業）
```

### 2. 各レベルでWHAT→HOWを完了してから次へ

```
✓ L1: 価値が明確 → Value Streamが定義できる
✓ L2: Capabilityが明確 → Service境界が決まる
✓ L3: 設計が明確 → 実装できる
```

### 3. 上位レベルの決定は下位に影響

```
価値変更 → 全レベルに影響（大）
Capability変更 → L2-L3に影響（中）
設計変更 → L3のみ影響（小）
```

---

## 参照

- `/parasol:0-help concepts` - 主要概念の説明
- `/parasol:0-help workflow` - 実行ワークフロー
