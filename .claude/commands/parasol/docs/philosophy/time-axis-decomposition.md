# 時間軸でのケイパビリティ分割：V5のメインコンセプト

**バージョン**: 1.0
**最終更新**: 2025-01-08
**位置づけ**: V5設計思想の核心

---

## 核心的主張

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  V5のメインコンセプト：                                                     │
│                                                                              │
│  「時間軸でケイパビリティを分割し、                                         │
│   ステージごとの関心事をサブドメインとして認識することで、                  │
│   変更に強いマイクロサービス設計を実現する」                                │
│                                                                              │
│  これが従来のソフトウェア設計との根本的な違いである                         │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 従来のソフトウェア設計との違い

### 従来：機能ドメインで分割

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  従来のドメイン分割                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│      「何を扱うか」で分割                                                   │
│                                                                              │
│      ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐                  │
│      │ 顧客管理 │ │ 商品管理 │ │ 注文管理 │ │ 在庫管理 │                  │
│      │ Customer │ │ Product  │ │  Order   │ │ Inventory│                  │
│      └──────────┘ └──────────┘ └──────────┘ └──────────┘                  │
│                                                                              │
│      問い：「このシステムは何を扱うか？」                                   │
│      答え：「顧客、商品、注文、在庫を扱う」                                 │
│                                                                              │
│      → 名詞（エンティティ）ベースの分割                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### V5：時間軸（VSステージ）で分割

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  V5のステージ分割                                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│      「いつ価値を届けるか」で分割                                           │
│                                                                              │
│      時間の流れ ─────────────────────────────────────────────▶             │
│                                                                              │
│      ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐                  │
│      │ 認知獲得 │→│ 検討支援 │→│ 購買完了 │→│ 利用支援 │                  │
│      │ Awareness│ │Consider  │ │ Purchase │ │  Usage   │                  │
│      └──────────┘ └──────────┘ └──────────┘ └──────────┘                  │
│           BC1          BC2          BC3          BC4                        │
│                                                                              │
│      問い：「顧客にいつどんな価値を届けるか？」                             │
│      答え：「認知→検討→購買→利用の各段階で価値を届ける」                 │
│                                                                              │
│      → 時間軸（ステージ）ベースの分割                                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 分割軸の比較

| 観点 | 従来（機能ドメイン） | V5（時間軸ステージ） |
|------|---------------------|---------------------|
| **分割の問い** | 「何を扱うか？」 | 「いつ価値を届けるか？」 |
| **分割の基準** | エンティティ（名詞） | ステージ（時間） |
| **サブドメインの定義** | 扱う対象（顧客、商品、注文） | 価値提供の段階（認知→検討→購買） |
| **境界の性質** | 機能的境界 | 時間的境界 |
| **凝集の軸** | 同じ対象を扱う処理 | 同じ瞬間に必要な処理 |

---

## なぜ時間軸分割が変更に強いか

### 理由1：ビジネス変更は特定ステージに集中する

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  変更の局所化                                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ビジネス変更の例：「購買プロセスを改善したい」                             │
│                                                                              │
│  【従来の機能ドメイン分割】                                                 │
│                                                                              │
│      顧客管理 ─┬─ 影響（顧客情報の参照方法変更）                           │
│      商品管理 ─┼─ 影響（商品表示の変更）                                   │
│      注文管理 ─┼─ 影響（注文フローの変更）  ← 複数ドメインに波及          │
│      在庫管理 ─┴─ 影響（在庫引当タイミング変更）                           │
│                                                                              │
│      → 「購買」という行為が複数ドメインにまたがっている                    │
│      → 変更が波及し、影響範囲の特定が困難                                  │
│                                                                              │
│  【V5の時間軸分割】                                                         │
│                                                                              │
│      認知獲得 ─── 影響なし                                                 │
│      検討支援 ─── 影響なし                                                 │
│      購買完了 ─── 影響あり  ← このBCだけ変更                              │
│      利用支援 ─── 影響なし                                                 │
│                                                                              │
│      → 「購買完了」ステージに関心事が凝集している                          │
│      → 変更がステージ内に局所化される                                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 理由2：時間的境界は安定している

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  境界の安定性                                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  【機能的境界の不安定さ】                                                   │
│                                                                              │
│      新機能追加時：                                                         │
│      「ポイント管理」を追加 → 顧客管理？注文管理？新ドメイン？             │
│      「レコメンド機能」を追加 → 商品管理？顧客管理？新ドメイン？           │
│                                                                              │
│      → 機能追加のたびに境界の再定義が必要                                  │
│      → ドメイン間の責務の押し付け合いが発生                                │
│                                                                              │
│  【時間的境界の安定性】                                                     │
│                                                                              │
│      新機能追加時：                                                         │
│      「ポイント管理」を追加 → 購買完了ステージに追加                       │
│      「レコメンド機能」を追加 → 検討支援ステージに追加                     │
│                                                                              │
│      → 「いつ必要か」で配置先が明確                                        │
│      → 価値提供の流れは変わらないので境界が安定                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 理由3：関心事の自然な凝集

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  「この瞬間に必要なこと」の凝集                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  【購買完了ステージの例】                                                   │
│                                                                              │
│      このステージで必要な関心事：                                           │
│                                                                              │
│      ┌─────────────────────────────────────────────────────────────────┐   │
│      │  購買完了ステージ（BC）                                          │   │
│      │                                                                  │   │
│      │    ・カート確定（この瞬間の関心事）                              │   │
│      │    ・在庫引当（この瞬間の関心事）                                │   │
│      │    ・決済処理（この瞬間の関心事）                                │   │
│      │    ・注文確定（この瞬間の関心事）                                │   │
│      │    ・確認通知（この瞬間の関心事）                                │   │
│      │                                                                  │   │
│      │  → 「購買を完了させる」という目的に凝集                          │   │
│      │  → 高凝集・低結合が自然に実現                                    │   │
│      └─────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  従来の分割では：                                                           │
│      ・カート確定 → 注文管理                                               │
│      ・在庫引当 → 在庫管理                                                 │
│      ・決済処理 → 決済管理                                                 │
│      ・注文確定 → 注文管理                                                 │
│      ・確認通知 → 通知管理                                                 │
│                                                                              │
│      → 「購買完了」という一連の流れが5つのドメインに分散                   │
│      → 変更時に5つのドメインの調整が必要                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## DDDとの接続：時間軸でのサブドメイン認識

### 従来のDDD

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  従来のサブドメイン認識                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│      サブドメイン = 機能的な関心事の塊                                      │
│                                                                              │
│      ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │
│      │   注文      │  │   配送      │  │   請求      │                    │
│      │ Subdomain   │  │ Subdomain   │  │ Subdomain   │                    │
│      │             │  │             │  │             │                    │
│      │ ・注文作成  │  │ ・配送手配  │  │ ・請求作成  │                    │
│      │ ・注文変更  │  │ ・配送追跡  │  │ ・入金管理  │                    │
│      │ ・注文取消  │  │ ・配達完了  │  │ ・督促処理  │                    │
│      └─────────────┘  └─────────────┘  └─────────────┘                    │
│                                                                              │
│      問い：「このビジネスにはどんな機能領域があるか？」                     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### V5のDDD

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  V5のサブドメイン認識                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│      サブドメイン = 時間軸での関心事の塊                                    │
│                                                                              │
│      時間の流れ ─────────────────────────────────────────────▶             │
│                                                                              │
│      ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │
│      │  購買完了   │  │  出荷準備   │  │  配達完了   │                    │
│      │  Subdomain  │  │  Subdomain  │  │  Subdomain  │                    │
│      │             │  │             │  │             │  │                    │
│      │ ・注文確定  │  │ ・ピッキング│  │ ・配達確認  │                    │
│      │ ・決済処理  │  │ ・梱包      │  │ ・受領確認  │                    │
│      │ ・在庫引当  │  │ ・出荷手配  │  │ ・請求確定  │                    │
│      │ ・確認通知  │  │ ・追跡開始  │  │ ・完了通知  │                    │
│      └─────────────┘  └─────────────┘  └─────────────┘                    │
│                                                                              │
│      問い：「顧客への価値提供はどんな段階を経るか？」                       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### サブドメイン認識の違い

| 観点 | 従来のDDD | V5のDDD |
|------|----------|---------|
| **サブドメインの定義** | 機能的な関心事の塊 | 時間軸での関心事の塊 |
| **境界の決め方** | 「何を扱うか」で分ける | 「いつ必要か」で分ける |
| **凝集の原理** | 同じエンティティを扱う | 同じ瞬間に必要 |
| **BCとの対応** | 機能ドメイン = BC | ステージ = BC |

---

## マイクロサービス設計への直結

### V5の一貫した対応関係

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  V5の設計トレーサビリティ                                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│      Value Stream                                                           │
│           │                                                                 │
│           ▼                                                                 │
│      ┌─────────┐                                                           │
│      │ Stage   │ ← 時間軸での分割点                                       │
│      └────┬────┘                                                           │
│           │                                                                 │
│           ▼                                                                 │
│      ┌─────────┐                                                           │
│      │  CL2    │ ← Subdomain（問題領域：何の能力が必要か）                │
│      │Subdomain│                                                           │
│      └────┬────┘                                                           │
│           │                                                                 │
│           ▼                                                                 │
│      ┌─────────┐                                                           │
│      │  CL3    │ ← Bounded Context（実装境界：どう実装するか）            │
│      │   BC    │                                                           │
│      └────┬────┘                                                           │
│           │                                                                 │
│           ▼                                                                 │
│      ┌─────────┐                                                           │
│      │ Service │ ← BC = マイクロサービス = Database                       │
│      └─────────┘                                                           │
│                                                                              │
│      Stage → CL2（Subdomain）→ CL3（BC）→ Service → Database             │
│                                                                              │
│      ・CL2 : CL3 = 1 : 1（シンプルな場合）                                 │
│      ・CL2 : CL3 = 1 : N（複雑な場合）                                     │
│                                                                              │
│      → この一貫した対応関係が、変更に強いアーキテクチャを生む              │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 変更に強い理由の総括

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  なぜV5が変更に強いか                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. 時間軸分割により関心事が自然に凝集                                      │
│     → 高凝集・低結合が構造的に実現                                         │
│                                                                              │
│  2. ビジネス変更は特定ステージに集中                                        │
│     → 変更影響がステージ内に局所化                                         │
│                                                                              │
│  3. 価値提供の流れは安定している                                            │
│     → 境界が機能追加で揺らがない                                           │
│                                                                              │
│  4. Stage = BC = Service の一貫性                                           │
│     → 設計から実装まで迷いがない                                           │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 具体例：ECサイトの設計比較

### 従来の機能ドメイン設計

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  従来のECサイト設計                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│      ┌───────────────┐                                                     │
│      │   顧客管理    │ ← 顧客情報、認証、プロファイル                      │
│      └───────────────┘                                                     │
│      ┌───────────────┐                                                     │
│      │   商品管理    │ ← 商品情報、カテゴリ、価格                          │
│      └───────────────┘                                                     │
│      ┌───────────────┐                                                     │
│      │   カート管理  │ ← カート操作、一時保存                              │
│      └───────────────┘                                                     │
│      ┌───────────────┐                                                     │
│      │   注文管理    │ ← 注文作成、変更、キャンセル                        │
│      └───────────────┘                                                     │
│      ┌───────────────┐                                                     │
│      │   在庫管理    │ ← 在庫数、引当、補充                                │
│      └───────────────┘                                                     │
│      ┌───────────────┐                                                     │
│      │   決済管理    │ ← 決済処理、返金                                    │
│      └───────────────┘                                                     │
│      ┌───────────────┐                                                     │
│      │   配送管理    │ ← 配送手配、追跡                                    │
│      └───────────────┘                                                     │
│                                                                              │
│      問題：「購入する」という行為が7つのドメインにまたがる                  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### V5の時間軸設計

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  V5のECサイト設計（購買VSの例）                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│      VS: 商品購買バリューストリーム                                         │
│                                                                              │
│      時間 ───────────────────────────────────────────────────────▶         │
│                                                                              │
│      ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐              │
│      │  商品探索  │→│  検討比較  │→│  購買完了  │→│  受取確認  │              │
│      │   Stage   │ │   Stage   │ │   Stage   │ │   Stage   │              │
│      └───────────┘ └───────────┘ └───────────┘ └───────────┘              │
│           │             │             │             │                       │
│           ▼             ▼             ▼             ▼                       │
│      ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐              │
│      │  探索BC   │ │  検討BC   │ │  購買BC   │ │  受取BC   │              │
│      │           │ │           │ │           │ │           │              │
│      │・商品検索 │ │・比較表示 │ │・カート確定│ │・配送追跡 │              │
│      │・カテゴリ │ │・レビュー │ │・在庫引当 │ │・受取確認 │              │
│      │・レコメンド│ │・お気に入り│ │・決済処理 │ │・評価投稿 │              │
│      │・閲覧履歴 │ │・価格比較 │ │・注文確定 │ │・返品受付 │              │
│      └───────────┘ └───────────┘ └───────────┘ └───────────┘              │
│                                                                              │
│      利点：「購買完了」の変更は購買BCだけで完結                             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## BizBOKとの対比

| 観点 | BizBOK | V5 |
|------|--------|-----|
| **ケイパビリティの位置づけ** | 組織管理の中心軸 | 価値実現の手段 |
| **分割の軸** | 能力の種類（機能的） | 価値提供の時間軸 |
| **Cross-Mapping** | Cap×VSの多対多 | VS内でステージ分割 |
| **マイクロサービスへの接続** | 間接的 | 直接的（Stage=BC=Service） |

---

## 結論

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  V5のメインコンセプト：時間軸でのケイパビリティ分割                         │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  従来：「何を扱うか」で分割 → 変更が複数ドメインに波及              │   │
│  │                                                                      │   │
│  │  V5：  「いつ価値を届けるか」で分割 → 変更がステージ内に局所化      │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  この「時間軸での関心事分離」が、V5が変更に強いマイクロサービス設計を      │
│  実現できる根本的な理由である。                                             │
│                                                                              │
│  Stage = Subdomain = BC = Microservice                                      │
│                                                                              │
│  この一貫した対応関係が、ビジネスアーキテクチャから                         │
│  ソフトウェアアーキテクチャへの直線的トレーサビリティを実現する。           │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 関連ドキュメント

- [cl-hierarchy.md](./cl-hierarchy.md) - CL階層の詳細定義
- [V5-BIZBOK-DESIGN-PHILOSOPHY-JA.md](../reference/V5-BIZBOK-DESIGN-PHILOSOPHY-JA.md) - BizBOKとの設計思想比較
- [V5-BIZBOK-COMPARISON.md](../reference/V5-BIZBOK-COMPARISON.md) - L1/L2/L3分解比較

---

**Parasol V5 - 時間軸分割による変更に強いマイクロサービス設計フレームワーク**
