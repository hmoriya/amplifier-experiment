# Axiomatic Design（公理的設計）入門

**「良い設計」を科学的に判断する方法**

---

## この資料の目的

「この設計は良いのか？」という主観的な議論を、**2つのシンプルな原則**で客観的に判断できるようにする。

---

## Axiomatic Designとは？

### 一言で言うと

> **「良い設計かどうかを判断する2つの公理（原則）」**

MITのNam P. Suh教授が提唱した設計理論。製造業からソフトウェアまで幅広く適用可能。

### なぜ重要か

| 従来の設計レビュー | Axiomatic Design |
|------------------|------------------|
| 「なんとなく複雑」 | 「情報公理に違反」 |
| 「依存関係が多い気がする」 | 「独立公理に違反」 |
| 経験と勘に依存 | 測定可能な基準 |

---

## 基本用語：FR と DP

Axiomatic Designを理解するには、まず2つの基本概念を押さえる必要があります。

### FR（Functional Requirements）= 機能要件

> **「何を実現するか」（WHAT）**

システムが達成すべき機能や振る舞いを定義したもの。

```
例：ECサイトの場合
├── FR1: ユーザーが商品を検索できる
├── FR2: ユーザーが商品をカートに追加できる
├── FR3: ユーザーが決済できる
└── FR4: ユーザーが注文履歴を確認できる
```

**ポイント**:
- 「どう実現するか」ではなく「何を実現するか」
- ユーザー視点で記述される
- Parasol V5では **CL3（詳細能力）+ BO（業務オペレーション）** に相当

### DP（Design Parameters）= 設計パラメータ

> **「どう実現するか」（HOW）**

FRを実現するための具体的な設計要素。

```
例：ECサイトの場合
├── DP1: 商品検索サービス（Elasticsearch使用）
├── DP2: カート管理サービス（セッション/DB保存）
├── DP3: 決済サービス（Stripe連携）
└── DP4: 注文管理サービス（注文履歴DB）
```

**ポイント**:
- FRを「どう」実現するかの設計判断
- 技術的な選択を含む
- Parasol V5では **BC（Bounded Context）/ サービス** に相当

### FR と DP の関係

```
┌─────────────────────────────────────────────────────────────────┐
│                    FR → DP の対応関係                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   WHAT（何を）              HOW（どう）                         │
│   ─────────────            ─────────────                        │
│   FR1: 商品検索      →     DP1: 検索サービス                    │
│   FR2: カート追加    →     DP2: カートサービス                  │
│   FR3: 決済          →     DP3: 決済サービス                    │
│   FR4: 注文履歴      →     DP4: 注文サービス                    │
│                                                                 │
│   理想: 1つのFRは1つのDPで実現される（1:1対応）                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Parasol V5との対応

| Axiomatic Design | Parasol V5 | 説明 |
|-----------------|------------|------|
| FR（機能要件） | CL3（詳細能力）+ BO | 何を実現するか |
| DP（設計パラメータ） | BC / UseCase / Service | どう実現するか |
| FR-DP対応 | CL3-BC対応 | Design Matrixで評価 |

### 3スペースとFR/DPの関係

Parasol V5は3つのスペース（領域）でシステムを設計します。FR/DPはこの中でどこに位置するのでしょうか？

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    3スペースとFR/DPの対応                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【Value Space】価値領域（Phase 1-2）                                        │
│  ─────────────────────────────────────                                      │
│    WHY: なぜこのプロジェクトが必要か                                         │
│    VL1 → VL2 → VL3（価値階層）                                              │
│    ※ Axiomatic Designでは扱わない領域                                       │
│         ↓                                                                   │
│         ↓ 価値からFRを導出                                                  │
│         ↓                                                                   │
│  【Problem Space】問題領域（Phase 3）= Functional Domain                     │
│  ─────────────────────────────────────                                      │
│    WHAT: 何を解決するか                                                      │
│    CL1 → CL2 → CL3（ケイパビリティ階層）                                     │
│                  ↑                                                          │
│                  └── FR（機能要件）はここに対応                              │
│         ↓                                                                   │
│         ↓ FRからDPを設計（ZIGZAG）                                          │
│         ↓                                                                   │
│  【Solution Space】解決領域（Phase 4-6）= Physical Domain                    │
│  ─────────────────────────────────────                                      │
│    HOW: どう解決するか                                                       │
│    BC → UseCase → Service → 実装                                            │
│    ↑                                                                        │
│    └── DP（設計パラメータ）はここに対応                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**重要なポイント**:

| 観点 | Axiomatic Design | Parasol V5 |
|------|-----------------|------------|
| **WHY（なぜ）** | 扱わない | Value Space（VL1-VL3）で明示的に定義 |
| **WHAT（何を）** | FR = Functional Domain | Problem Space = CL3 |
| **HOW（どう）** | DP = Physical Domain | Solution Space = BC/Service |

**Parasolの強み**:
- Axiomatic DesignはFR→DPの変換（WHAT→HOW）に特化
- Parasolは**WHY（価値）からFRを導出**することで、「なぜその機能が必要か」を明確化
- 価値からの一貫したトレーサビリティを確保

---

## 2つの公理：核心の理解

### 公理の本質（一言で）

| 公理 | 核心 | レビューでの問い |
|------|------|------------------|
| **独立公理** | 機能の分離 | 「一つを変えたとき、他に影響するか？」 |
| **情報公理** | 成功確率の最大化 | 「この設計で失敗する余地はどこか？」 |

> **ポイント**: 情報公理は「シンプル」ではなく「**成功確率**」で理解する。
> 原典の定義は I = log₂(1/p) で、pは「設計が機能要件を満たす確率」。
> 情報量が小さい ＝ 成功確率が高い ＝ 良い設計。

---

### 公理1: 独立公理（Independence Axiom）

> **「機能は互いに独立させよ」**
>
> 本質：**一つのFRを変更したとき、他のFRに影響しない設計**

#### 悪い例 ❌
```
ユーザー登録機能を変更すると...
  → 決済機能も壊れる
  → 通知機能も壊れる
  → テストが全部やり直し
```

#### 良い例 ✅
```
ユーザー登録機能を変更しても...
  → 決済機能は影響なし
  → 通知機能は影響なし
  → その機能のテストだけでOK
```

#### ビジネスへの影響

| 独立公理違反 | 独立公理遵守 |
|-------------|-------------|
| 変更リスクが高い | 変更が安全 |
| テスト工数が大きい | テスト工数が小さい |
| 開発スピードが遅い | 開発スピードが速い |
| 障害が連鎖する | 障害が局所化する |

---

### 公理2: 情報公理（Information Axiom）

> **「成功確率を最大化せよ」**
>
> 本質：**設計が正しく機能する確率が最も高い選択肢を選ぶ**

#### なぜ「シンプル」ではなく「成功確率」か

「シンプル」は曖昧で解釈の幅が広すぎる。原典の情報公理は明確：

```
情報量 I = log₂(1/p)

p = 設計が機能要件を満たす確率
I = 情報量（小さいほど良い）

つまり：成功確率pが高い設計ほど、情報量Iは小さい
```

**「情報量」とは何か（原典の定義）**：

> 設計を正しく実現するために必要な「**知識・判断・仕様の量**」

| 情報量が多い設計 | 情報量が少ない設計 |
|------------------|-------------------|
| 実装者が多くの判断を迫られる | 判断の余地が少ない |
| 暗黙の前提知識が必要 | 明示的で自己説明的 |
| 仕様書が膨大になる | 仕様書が簡潔 |
| 迷う余地が多い → 失敗しやすい | 迷う余地が少ない → 成功しやすい |

**「シンプル」は結果であり、原因ではない**：
- 成功確率が高い設計 → 結果として理解しやすい（シンプルに見える）
- 成功確率が高い設計 → 結果として保守しやすい
- 成功確率が高い設計 → 結果として新人が理解しやすい

#### 成功確率を最大化する方法

**ステップ1: 失敗する余地を特定する**

設計を見て「どこで失敗しうるか？」を問う：

| 失敗の種類 | 問い | 例 |
|-----------|------|-----|
| **理解の失敗** | この設計を見て、実装者は迷わないか？ | 責務が曖昧、命名が不明確 |
| **実装の失敗** | 正しく実装するために特別な知識が必要か？ | 暗黙の前提、隠れた依存 |
| **変更の失敗** | 将来の変更で壊れやすい箇所はないか？ | 密結合、マジックナンバー |
| **運用の失敗** | 本番で問題が起きたとき原因特定できるか？ | ログ不足、状態の不透明さ |

**ステップ2: 失敗の余地を排除する**

| 失敗の余地 | 排除する方法 |
|-----------|-------------|
| 曖昧な責務 | → 一つのコンポーネントに一つの責務 |
| 暗黙の前提 | → 明示的なインターフェース定義 |
| 隠れた依存 | → 依存関係を可視化・最小化 |
| 複雑な条件分岐 | → 状態パターンや戦略パターンで分離 |
| 特殊な知識が必要 | → ドキュメント化 or 設計で強制 |

**ステップ3: 検証する**

> 「新人エンジニアがこの設計を見て、正しく実装できるか？」

Yesなら情報公理を満たしている。Noなら失敗の余地がある。

#### 悪い例 ❌（成功確率が低い）
```
商品管理システム
├── 商品マスタBC
│   ├── 基本情報サービス
│   ├── 価格サービス
│   ├── 在庫サービス
│   ├── カテゴリサービス
│   ├── タグサービス
│   ├── 画像サービス
│   └── SEOサービス ← 7つのサービス！
└── ... 他にも大量のBC
```

#### 良い例 ✅（成功確率が高い）
```
商品管理システム
├── 商品BC
│   ├── 商品サービス（基本・価格・在庫）
│   └── 表示サービス（画像・SEO）
└── カタログBC
    └── カテゴリサービス ← 必要最小限！
```

**なぜ成功確率が高いか**：
- 要素が少ない → 実装ミスの余地が少ない
- 責務が明確 → 誤解による設計ミスが起きにくい
- 依存が少ない → 連鎖障害のリスクが低い

#### ビジネスへの影響

| 情報公理違反（成功確率↓） | 情報公理遵守（成功確率↑） |
|---------------------------|---------------------------|
| 理解に時間がかかる | すぐ理解できる |
| 新人が育たない | 新人がすぐ戦力に |
| ドキュメントが膨大 | ドキュメントが簡潔 |
| 保守コストが高い | 保守コストが低い |
| **実装ミスが多い** | **実装ミスが少ない** |

---

## 具体例：Design Matrix

設計の品質を可視化する「Design Matrix」という手法があります。

### 読み方

```
        設計パラメータ（HOW: どう実現するか）
              DP1    DP2    DP3
機        FR1 [ X     0      0  ]
能        FR2 [ 0     X      0  ]
要        FR3 [ 0     0      X  ]
件
（WHAT: 何を実現するか）

X = 関係あり、0 = 関係なし
```

### 3つのパターン

```
【Uncoupled】独立公理を満たす ✅ 最良
┌─────────────────────────────────────┐
│     DP1   DP2   DP3                 │
│ FR1 [X     0     0 ]  ← FR1はDP1だけで実現 │
│ FR2 [0     X     0 ]  ← FR2はDP2だけで実現 │
│ FR3 [0     0     X ]  ← FR3はDP3だけで実現 │
└─────────────────────────────────────┘
どの機能も独立して変更可能！

【Decoupled】順序依存で許容 △ 許容
┌─────────────────────────────────────┐
│     DP1   DP2   DP3                 │
│ FR1 [X     0     0 ]                │
│ FR2 [X     X     0 ]  ← FR2はDP1とDP2が必要 │
│ FR3 [0     X     X ]  ← FR3はDP2とDP3が必要 │
└─────────────────────────────────────┘
順番に変更すればOK

【Coupled】独立公理に違反 ❌ 再設計が必要
┌─────────────────────────────────────┐
│     DP1   DP2   DP3                 │
│ FR1 [X     X     0 ]                │
│ FR2 [X     X     X ]  ← すべてが絡み合う │
│ FR3 [0     X     X ]                │
└─────────────────────────────────────┘
どこを変えても影響が予測不能！
```

---

## Parasol V5での適用

### Parasol自体が情報公理を体現している

Parasolのフレームワーク構造そのものが「情報量の最小化」を実現しています。

```
┌─────────────────────────────────────────────────────────────┐
│  Parasol = 情報公理の具現化                                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【従来の開発】                                              │
│  要件 → ???  → 実装                                         │
│         ↑                                                   │
│      判断の余地が多い = 情報量大 = 失敗しやすい               │
│                                                             │
│  【Parasolの開発】                                           │
│  VS → VL → CL1 → CL2 → CL3 → BC → 実装                      │
│   ↓    ↓    ↓     ↓     ↓    ↓                              │
│  各段階で判断が明確 = 情報量小 = 成功しやすい                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

| Parasol要素 | 削減される「判断・知識・仕様」 |
|------------|------------------------------|
| **VS（バリューステージ）** | 顧客状態の定義で「誰のため？」が明確に |
| **VL（バリューレベル）** | 価値階層で「なぜ必要？」が明確に |
| **CL1→CL2→CL3** | 段階的分解で「何を作る？」が明確に |
| **BC** | 境界定義で「どう分ける？」が明確に |

> **ポイント**: Parasolを使うこと自体が、情報公理に従った設計プロセスになっている。
> 各フェーズで「実装者が迷う余地」を段階的に排除していく。

---

### Phase別チェックポイント

| Phase | 適用する公理 | チェック内容 |
|-------|-------------|-------------|
| Phase 2（価値定義） | 情報公理 | VL階層が3以下か |
| Phase 3（ケイパビリティ） | 独立公理 | CL3間の依存がないか |
| Phase 4（アーキテクチャ） | 両方 | Design MatrixがUncoupledか |
| Phase 5（ソフトウェア設計） | 情報公理 | Aggregate数が最小限か |
| Phase 6（実装） | 独立公理 | Service間に循環依存がないか |

### 合格基準の例

```
✅ 合格基準
- 階層深度: ≤ 3
- BC数 / CL3数: ≤ 1.2
- Coupled設計: 0件
- 循環依存: 0件

❌ 不合格（要改善）
- 階層深度: > 3
- BC数 / CL3数: > 1.5
- Coupled設計: 1件以上
- 循環依存: 1件以上
```

---

## よくある質問

### Q1: 全部Uncoupledにしないとダメ？

**A:** いいえ。現実的にはDecoupled（順序依存）も許容されます。
重要なのは**Coupledを避ける**こと。

### Q2: 既存システムに適用できる？

**A:** できます。Design Matrixで現状を可視化し、
Coupled部分を優先的にリファクタリングします。

### Q3: 開発が遅くなりませんか？

**A:** 初期は少し時間がかかりますが、
**変更・保守・テストのコストが大幅に減る**ため、
中長期では開発スピードが上がります。

### Q4: マイクロサービスとの関係は？

**A:** マイクロサービス = 独立公理の実践
各サービスが独立していれば、独立公理を満たしています。

---

## まとめ

### 覚えることは2つだけ

```
┌─────────────────────────────────────────────┐
│  公理1: 独立公理                              │
│  「機能は互いに独立させよ」                    │
│  → 変更が安全、テストが楽、障害が局所化        │
├─────────────────────────────────────────────┤
│  公理2: 情報公理                              │
│  「成功確率を最大化せよ」                      │
│  → 実装ミスが減る、保守が楽、新人が育つ        │
└─────────────────────────────────────────────┘
```

### 今日から使える判断基準

設計レビューで迷ったら：

1. **「この変更は他に影響するか？」** → 独立公理チェック
2. **「この設計で失敗する余地はどこか？」** → 情報公理チェック

---

## 参考資料

- **原典**: Nam P. Suh, "The Principles of Design" (Oxford University Press, 2001)
- **Parasol V5詳細**: [zigzag-foundations.md](../philosophy/zigzag-foundations.md#axiomatic-designの2つの公理)
- **チェックリスト**: [philosophy-checkpoints.md](../philosophy/philosophy-checkpoints.md)

---

## 付録：説明用スライド案

### スライド1: タイトル
```
Axiomatic Design入門
〜「良い設計」を科学的に判断する〜
```

### スライド2: 課題
```
❌ 従来の設計レビュー
・「なんとなく複雑」
・「依存関係が多い気がする」
・経験と勘に依存

↓

✅ Axiomatic Design
・測定可能な基準
・誰でも同じ判断
・科学的なアプローチ
```

### スライド3: 2つの公理
```
┌─────────────────┐  ┌─────────────────┐
│    独立公理      │  │    情報公理      │
│  機能を独立させよ │  │ 成功確率を最大化 │
│                 │  │                 │
│  変更が安全     │  │ 実装ミスが減る   │
│  テストが楽     │  │ 保守が楽        │
│  障害が局所化   │  │ 新人が育つ      │
└─────────────────┘  └─────────────────┘
```

### スライド4: 判断基準
```
設計レビューで迷ったら...

Q1: この変更は他に影響するか？
    → Yes: 独立公理違反の可能性

Q2: この設計で失敗する余地はどこか？
    → ある: 情報公理違反の可能性
```
